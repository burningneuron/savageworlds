window.CodeMirror=function(){function y(e,n){if(!(this instanceof y))return new y(e,n);this.options=n=n||{};for(var r in Sn)!n.hasOwnProperty(r)&&Sn.hasOwnProperty(r)&&(n[r]=Sn[r]);A(n);var i=this.display=b(e);i.wrapper.CodeMirror=this,C(this),n.autofocus&&!d&&yt(this),this.view=w(new gr([new mr([rr("",null,at(i))])])),this.nextOpId=0,E(this),T(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),this.setValue(n.value||""),t&&setTimeout(Kr(gt,this,!0),20),this.view.history=Tr(),wt(this);var s;try{s=document.activeElement==i.input}catch(o){}s||n.autofocus&&!d?setTimeout(Kr(Vt,this),20):$t(this),ht(this,function(){for(var e in En)En.propertyIsEnumerable(e)&&En[e](this,n[e],Tn);for(var t=0;t<Ln.length;++t)Ln[t](this)})()}function b(e){var t={},r=t.input=ei("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none;");r.setAttribute("wrap","off"),r.setAttribute("autocorrect","off"),r.setAttribute("autocapitalize","off"),t.inputDiv=ei("div",[r],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),t.scrollbarH=ei("div",[ei("div",null,null,"height: 1px")],"CodeMirror-hscrollbar"),t.scrollbarV=ei("div",[ei("div",null,null,"width: 1px")],"CodeMirror-vscrollbar"),t.scrollbarFiller=ei("div",null,"CodeMirror-scrollbar-filler"),t.lineDiv=ei("div"),t.selectionDiv=ei("div",null,null,"position: relative; z-index: 1"),t.cursor=ei("pre"," ","CodeMirror-cursor"),t.otherCursor=ei("pre"," ","CodeMirror-cursor CodeMirror-secondarycursor"),t.measure=ei("div",null,"CodeMirror-measure"),t.lineSpace=ei("div",[t.measure,t.selectionDiv,t.lineDiv,t.cursor,t.otherCursor],null,"position: relative; outline: none"),t.mover=ei("div",[ei("div",[t.lineSpace],"CodeMirror-lines")],null,"position: relative"),t.sizer=ei("div",[t.mover],"CodeMirror-sizer"),t.heightForcer=ei("div"," ",null,"position: absolute; height: "+Ir+"px"),t.gutters=ei("div",null,"CodeMirror-gutters"),t.lineGutter=null;var s=ei("div",[t.sizer,t.heightForcer,t.gutters],null,"position: relative; min-height: 100%");return t.scroller=ei("div",[s],"CodeMirror-scroll"),t.scroller.setAttribute("tabIndex","-1"),t.wrapper=ei("div",[t.inputDiv,t.scrollbarH,t.scrollbarV,t.scrollbarFiller,t.scroller],"CodeMirror"),n&&(t.gutters.style.zIndex=-1,t.scroller.style.paddingRight=0),e.appendChild?e.appendChild(t.wrapper):e(t.wrapper),p&&(r.style.width="0px"),i||(t.scroller.draggable=!0),f?(t.inputDiv.style.height="1px",t.inputDiv.style.position="absolute"):n&&(t.scrollbarH.style.minWidth=t.scrollbarV.style.minWidth="18px"),t.viewOffset=t.showingFrom=t.showingTo=t.lastSizeC=0,t.lineNumWidth=t.lineNumInnerWidth=t.lineNumChars=null,t.prevInput="",t.alignWidgets=!1,t.pollingFast=!1,t.poll=new Rr,t.draggingText=!1,t.cachedCharWidth=t.cachedTextHeight=null,t.measureLineCache=[],t.measureLineCachePos=0,t.inaccurateSelection=!1,t.pasteIncoming=!1,t}function w(e){var t={line:0,ch:0};return{doc:e,frontier:0,highlight:new Rr,sel:{from:t,to:t,head:t,anchor:t,shift:!1,extend:!1},scrollTop:0,scrollLeft:0,overwrite:!1,focused:!1,maxLine:yr(e,0),maxLineLength:0,maxLineChanged:!1,suppressEdits:!1,goalColumn:null,cantEdit:!1,keyMaps:[]}}function E(e){var t=e.view.doc;e.view.mode=y.getMode(e.options,e.options.mode),t.iter(0,t.size,function(e){e.stateAfter=null}),e.view.frontier=0,V(e,100)}function S(e){var t=e.view.doc,n=at(e.display);if(e.options.lineWrapping){e.display.wrapper.className+=" CodeMirror-wrap";var r=e.display.scroller.clientWidth/ft(e.display)-3;t.iter(0,t.size,function(e){if(e.height==0)return;var t=Math.ceil(e.text.length/r)||1;t!=1&&br(e,t*n)}),e.display.sizer.style.minWidth=""}else e.display.wrapper.className=e.display.wrapper.className.replace(" CodeMirror-wrap",""),L(e.view),t.iter(0,t.size,function(e){e.height!=0&&br(e,n)});pt(e,0,t.size),tt(e),setTimeout(function(){O(e.display,e.view.doc.height)},100)}function x(e){var t=_n[e.options.keyMap].style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(t?" cm-keymap-"+t:"")}function T(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),tt(e)}function N(e){C(e),B(e,!0)}function C(e){var t=e.display.gutters,n=e.options.gutters;ti(t);for(var r=0;r<n.length;++r){var i=n[r],s=t.appendChild(ei("div",null,"CodeMirror-gutter "+i));i=="CodeMirror-linenumbers"&&(e.display.lineGutter=s,s.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=r?"":"none"}function k(e,t){if(t.height==0)return 0;var n=t.text.length,r,i=t;while(r=$n(i)){var s=r.find();i=yr(e,s.from.line),n+=s.from.ch-s.to.ch}i=t;while(r=Jn(i)){var s=r.find();n-=i.text.length-s.from.ch,i=yr(e,s.to.line),n+=i.text.length-s.to.ch}return n}function L(e){e.maxLine=yr(e.doc,0),e.maxLineLength=k(e.doc,e.maxLine),e.maxLineChanged=!0,e.doc.iter(1,e.doc.size,function(t){var n=k(e.doc,t);n>e.maxLineLength&&(e.maxLineLength=n,e.maxLine=t)})}function A(e){var t=!1;for(var n=0;n<e.gutters.length;++n)e.gutters[n]=="CodeMirror-linenumbers"&&(e.lineNumbers?t=!0:e.gutters.splice(n--,1));!t&&e.lineNumbers&&e.gutters.push("CodeMirror-linenumbers")}function O(e,t){var n=t+2*Q(e);e.sizer.style.minHeight=e.heightForcer.style.top=n+"px";var r=Math.max(n,e.scroller.scrollHeight),i=e.scroller.scrollWidth>e.scroller.clientWidth,s=r>e.scroller.clientHeight;s?(e.scrollbarV.style.display="block",e.scrollbarV.style.bottom=i?ui(e.measure)+"px":"0",e.scrollbarV.firstChild.style.height=r-e.scroller.clientHeight+e.scrollbarV.clientHeight+"px"):e.scrollbarV.style.display="",i?(e.scrollbarH.style.display="block",e.scrollbarH.style.right=s?ui(e.measure)+"px":"0",e.scrollbarH.firstChild.style.width=e.scroller.scrollWidth-e.scroller.clientWidth+e.scrollbarH.clientWidth+"px"):e.scrollbarH.style.display="",i&&s?(e.scrollbarFiller.style.display="block",e.scrollbarFiller.style.height=e.scrollbarFiller.style.width=ui(e.measure)+"px"):e.scrollbarFiller.style.display="",l&&ui(e.measure)===0&&(e.scrollbarV.style.minWidth=e.scrollbarH.style.minHeight=c?"18px":"12px")}function M(e,t,n){var r=e.scroller.scrollTop,i=e.wrapper.clientHeight;typeof n=="number"?r=n:n&&(r=n.top,i=n.bottom-n.top),r=Math.floor(r-Q(e));var s=Math.ceil(r+i);return{from:Er(t,r),to:Er(t,s)}}function _(e){var t=e.display;if(!t.alignWidgets&&!t.gutters.firstChild)return;var n=H(t)-t.scroller.scrollLeft+e.view.scrollLeft,r=t.gutters.offsetWidth,i=n+"px";for(var s=t.lineDiv.firstChild;s;s=s.nextSibling)if(s.alignable)for(var o=0,u=s.alignable;o<u.length;++o)u[o].style.left=i;t.gutters.style.left=n+r+"px"}function D(e){if(!e.options.lineNumbers)return!1;var t=e.view.doc,n=P(e.options,t.size-1),r=e.display;if(n.length!=r.lineNumChars){var i=r.measure.appendChild(ei("div",[ei("div",n)],"CodeMirror-linenumber CodeMirror-gutter-elt")),s=i.firstChild.offsetWidth,o=i.offsetWidth-s;return r.lineGutter.style.width="",r.lineNumInnerWidth=Math.max(s,r.lineGutter.offsetWidth-o),r.lineNumWidth=r.lineNumInnerWidth+o,r.lineNumChars=r.lineNumInnerWidth?n.length:-1,r.lineGutter.style.width=r.lineNumWidth+"px",!0}return!1}function P(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function H(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function B(e,t,n){var r=e.display.showingFrom,i=e.display.showingTo,s=j(e,t,n);return s&&(jr(e,e,"update",e),(e.display.showingFrom!=r||e.display.showingTo!=i)&&jr(e,e,"viewportChange",e,e.display.showingFrom,e.display.showingTo)),U(e),O(e.display,e.view.doc.height),s}function j(e,t,r){var i=e.display,s=e.view.doc;if(!i.wrapper.clientWidth){i.showingFrom=i.showingTo=i.viewOffset=0;return}var o=M(i,s,r);if(t!==!0&&t.length==0&&o.from>i.showingFrom&&o.to<i.showingTo)return;t&&D(e)&&(t=!0),i.sizer.style.marginLeft=i.scrollbarH.style.left=i.gutters.offsetWidth+"px";if(t!==!0&&g)for(var u=0;u<t.length;++u){var a=t[u],f;while(f=$n(yr(s,a.from))){var l=f.find().from.line;a.diff&&(a.diff-=a.from-l),a.from=l}}var c=t===!0?0:Infinity;if(e.options.lineNumbers&&t&&t!==!0)for(var u=0;u<t.length;++u)if(t[u].diff){c=t[u].from;break}var l=Math.max(o.from-e.options.viewportMargin,0),h=Math.min(s.size,o.to+e.options.viewportMargin);i.showingFrom<l&&l-i.showingFrom<20&&(l=i.showingFrom),i.showingTo>h&&i.showingTo-h<20&&(h=Math.min(s.size,i.showingTo));if(g){l=wr(Kn(s,yr(s,l)));while(h<s.size&&Qn(yr(s,h)))++h}var p=t===!0?[]:F([{from:i.showingFrom,to:i.showingTo}],t),d=0;for(var u=0;u<p.length;++u){var v=p[u];v.from<l&&(v.from=l),v.to>h&&(v.to=h),v.from>=v.to?p.splice(u--,1):d+=v.to-v.from}if(d==h-l&&l==i.showingFrom&&h==i.showingTo)return;p.sort(function(e,t){return e.from-t.from}),d<(h-l)*.7&&(i.lineDiv.style.display="none"),q(e,l,h,p,c),i.lineDiv.style.display="";var m=l!=i.showingFrom||h!=i.showingTo||i.lastSizeC!=i.wrapper.clientHeight;m&&(i.lastSizeC=i.wrapper.clientHeight),i.showingFrom=l,i.showingTo=h,V(e,100);var y=i.lineDiv.offsetTop;for(var b=i.lineDiv.firstChild,w;b;b=b.nextSibling)if(b.lineObj){if(n){var E=b.offsetTop+b.offsetHeight;w=E-y,y=E}else{var S=b.getBoundingClientRect();w=S.bottom-S.top}var x=b.lineObj.height-w;w<2&&(w=at(i)),(x>.001||x<-0.001)&&br(b.lineObj,w)}return i.viewOffset=Sr(e,yr(s,l)),i.mover.style.top=i.viewOffset+"px",!0}function F(e,t){for(var n=0,r=t.length||0;n<r;++n){var i=t[n],s=[],o=i.diff||0;for(var u=0,a=e.length;u<a;++u){var f=e[u];i.to<=f.from&&i.diff?s.push({from:f.from+o,to:f.to+o}):i.to<=f.from||i.from>=f.to?s.push(f):(i.from>f.from&&s.push({from:f.from,to:i.from}),i.to<f.to&&s.push({from:i.to+o,to:f.to+o}))}e=s}return e}function I(e){var t=e.display,n={},r={};for(var i=t.gutters.firstChild,s=0;i;i=i.nextSibling,++s)n[e.options.gutters[s]]=i.offsetLeft,r[e.options.gutters[s]]=i.offsetWidth;return{fixedPos:H(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:n,gutterWidth:r,wrapperWidth:t.wrapper.clientWidth}}function q(e,n,r,s,o){function h(t){var n=t.nextSibling;return i&&v&&e.display.currentWheelTarget==t?(t.style.display="none",t.lineObj=null):l.removeChild(t),n}var u=I(e),a=e.display,f=e.options.lineNumbers;!s.length&&!t&&(!i||!e.display.currentWheelTarget)&&ti(a.lineDiv);var l=a.lineDiv,c=l.firstChild,p=s.shift(),d=n;e.view.doc.iter(n,r,function(t){p&&p.to==d&&(p=s.shift());if(Qn(t))t.height!=0&&br(t,0);else if(p&&p.from<=d&&p.to>d){while(c.lineObj!=t)c=h(c);f&&o<=d&&c.lineNumber&&ri(c.lineNumber,P(e.options,d)),c=c.nextSibling}else{var n=R(e,t,d,u);l.insertBefore(n,c),n.lineObj=t}++d});while(c)c=h(c)}function R(e,t,r,i){var s=lr(e,t),o=t.gutterMarkers,u=e.display;if(!e.options.lineNumbers&&!o&&!t.bgClass&&!t.wrapClass&&(!t.widgets||!t.widgets.length))return s;var a=ei("div",null,t.wrapClass,"position: relative");if(e.options.lineNumbers||o){var f=a.appendChild(ei("div",null,null,"position: absolute; left: "+i.fixedPos+"px"));a.alignable=[f],e.options.lineNumbers&&(!o||!o["CodeMirror-linenumbers"])&&(a.lineNumber=f.appendChild(ei("div",P(e.options,r),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+i.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+u.lineNumInnerWidth+"px")));if(o)for(var l=0;l<e.options.gutters.length;++l){var c=e.options.gutters[l],h=o.hasOwnProperty(c)&&o[c];h&&f.appendChild(ei("div",[h],"CodeMirror-gutter-elt","left: "+i.gutterLeft[c]+"px; width: "+i.gutterWidth[c]+"px"))}}t.bgClass&&a.appendChild(ei("div"," ",t.bgClass+" CodeMirror-linebackground")),a.appendChild(s);if(t.widgets)for(var p=0,d=t.widgets;p<d.length;++p){var v=d[p],m=ei("div",[v.node],"CodeMirror-linewidget");m.widget=v;if(v.noHScroll){(a.alignable||(a.alignable=[])).push(m);var g=i.wrapperWidth;m.style.left=i.fixedPos+"px",v.coverGutter||(g-=i.gutterTotalWidth,m.style.paddingLeft=i.gutterTotalWidth+"px"),m.style.width=g+"px"}v.coverGutter&&(m.style.zIndex=5,m.style.position="relative",v.noHScroll||(m.style.marginLeft=-i.gutterTotalWidth+"px")),v.above?a.insertBefore(m,e.options.lineNumbers&&t.height!=0?f:s):a.appendChild(m)}return n&&(a.style.zIndex=2),a}function U(e){var t=e.display,n=tn(e.view.sel.from,e.view.sel.to);n||e.options.showCursorWhenSelecting?z(e):t.cursor.style.display=t.otherCursor.style.display="none",n?t.selectionDiv.style.display="none":W(e);var r=it(e,e.view.sel.head,"div"),i=t.wrapper.getBoundingClientRect(),s=t.lineDiv.getBoundingClientRect();t.inputDiv.style.top=Math.max(0,Math.min(t.wrapper.clientHeight-10,r.top+s.top-i.top))+"px",t.inputDiv.style.left=Math.max(0,Math.min(t.wrapper.clientWidth-10,r.left+s.left-i.left))+"px"}function z(e){var t=e.display,n=it(e,e.view.sel.head,"div");t.cursor.style.left=n.left+"px",t.cursor.style.top=n.top+"px",t.cursor.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",t.cursor.style.display="",n.other?(t.otherCursor.style.display="",t.otherCursor.style.left=n.other.left+"px",t.otherCursor.style.top=n.other.top+"px",t.otherCursor.style.height=(n.other.bottom-n.other.top)*.85+"px"):t.otherCursor.style.display="none"}function W(e){function u(e,t,n,r){t<0&&(t=0),i.appendChild(ei("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(n==null?s-e:n)+"px; height: "+(r-t)+"px"))}function a(t,r,i,a){function h(n){return rt(e,{line:t,ch:n},"div",f)}var f=yr(n,t),l=f.text.length,c=a?Infinity:-Infinity;return di(xr(f),r||0,i==null?l:i,function(e,t,n){var f=h(n=="rtl"?t-1:e),p=h(n=="rtl"?e:t-1),d=f.left,v=p.right;p.top-f.top>3&&(u(d,f.top,null,f.bottom),d=o,f.bottom<p.top&&u(d,f.bottom,null,p.top)),i==null&&t==l&&(v=s),r==null&&e==0&&(d=o),c=a?Math.min(p.top,c):Math.max(p.bottom,c),d<o+1&&(d=o),u(d,p.top,v-d,p.bottom)}),c}var t=e.display,n=e.view.doc,r=e.view.sel,i=document.createDocumentFragment(),s=t.lineSpace.offsetWidth,o=G(e.display);if(r.from.line==r.to.line)a(r.from.line,r.from.ch,r.to.ch);else{var f=yr(n,r.from.line),l=f,c,h=[r.from.line,r.from.ch],p;while(c=Jn(l)){var d=c.find();h.push(d.from.ch,d.to.line,d.to.ch);if(d.to.line==r.to.line){h.push(r.to.ch),p=!0;break}l=yr(n,d.to.line)}if(p)for(var v=0;v<h.length;v+=3)a(h[v],h[v+1],h[v+2]);else{var m,g,y=yr(n,r.to.line);r.from.ch?m=a(r.from.line,r.from.ch,null,!1):m=Sr(e,f)-t.viewOffset,r.to.ch?g=a(r.to.line,$n(y)?null:0,r.to.ch,!0):g=Sr(e,y)-t.viewOffset,m<g&&u(o,m,null,g)}}ni(t.selectionDiv,i),t.selectionDiv.style.display=""}function X(e){var t=e.display;clearInterval(t.blinker);var n=!0;t.cursor.style.visibility=t.otherCursor.style.visibility="",t.blinker=setInterval(function(){if(!t.cursor.offsetHeight)return;t.cursor.style.visibility=t.otherCursor.style.visibility=(n=!n)?"":"hidden"},e.options.cursorBlinkRate)}function V(e,t){e.view.frontier<e.display.showingTo&&e.view.highlight.set(t,Kr($,e))}function $(e){var t=e.view,n=t.doc;if(t.frontier>=e.display.showingTo)return;var r=+(new Date)+e.options.workTime,i=An(t.mode,K(e,t.frontier)),s=[],o;n.iter(t.frontier,Math.min(n.size,e.display.showingTo+500),function(n){t.frontier>=e.display.showingFrom?(or(e,n,i)&&t.frontier>=e.display.showingFrom&&(o&&o.end==t.frontier?o.end++:s.push(o={start:t.frontier,end:t.frontier+1})),n.stateAfter=An(t.mode,i)):(ur(e,n,i),n.stateAfter=t.frontier%5==0?An(t.mode,i):null),++t.frontier;if(+(new Date)>r)return V(e,e.options.workDelay),!0}),s.length&&ht(e,function(){for(var e=0;e<s.length;++e)pt(this,s[e].start,s[e].end)})()}function J(e,t){var n,r,i=e.view.doc;for(var s=t,o=t-100;s>o;--s){if(s==0)return 0;var u=yr(i,s-1);if(u.stateAfter)return s;var a=Ur(u.text,null,e.options.tabSize);if(r==null||n>a)r=s-1,n=a}return r}function K(e,t){var n=e.view,r=J(e,t),i=r&&yr(n.doc,r-1).stateAfter;return i?i=An(n.mode,i):i=On(n.mode),n.doc.iter(r,t,function(s){ur(e,s,i);var o=r==t-1||r%5==0||r>=n.showingFrom&&r<n.showingTo;s.stateAfter=o?An(n.mode,i):null,++r}),i}function Q(e){return e.lineSpace.offsetTop}function G(e){var t=ni(e.measure,ei("pre")).appendChild(ei("span","x"));return t.offsetLeft}function Y(e,t,n,r){var r=r||Z(e,t),i=-1;for(var s=n;;s+=i){var o=r[s];if(o)break;i<0&&s==0&&(i=1)}return{left:s<n?o.right:o.left,right:s>n?o.left:o.right,top:o.top,bottom:o.bottom}}function Z(e,t){var n=e.display,r=e.display.measureLineCache;for(var i=0;i<r.length;++i){var s=r[i];if(s.text==t.text&&s.markedSpans==t.markedSpans&&n.scroller.clientWidth==s.width)return s.measure}var o=et(e,t),s={text:t.text,width:n.scroller.clientWidth,markedSpans:t.markedSpans,measure:o};return r.length==16?r[++n.measureLineCachePos%16]=s:r.push(s),o}function et(e,r){var i=e.display,s=Jr(r.text.length),o=lr(e,r,s);if(t&&!n&&!e.options.lineWrapping&&o.childNodes.length>100){var u=document.createDocumentFragment(),a=10,f=o.childNodes.length;for(var l=0,c=Math.ceil(f/a);l<c;++l){var h=ei("div",null,null,"display: inline-block");for(var p=0;p<a&&f;++p)h.appendChild(o.firstChild),--f;u.appendChild(h)}o.appendChild(u)}ni(i.measure,o);var d=i.lineDiv.getBoundingClientRect(),v=[],m=Jr(r.text.length),g=o.offsetHeight;for(var l=0,y;l<s.length;++l)if(y=s[l]){var b=y.getBoundingClientRect(),w=Math.max(0,b.top-d.top),E=Math.min(b.bottom-d.top,g);for(var p=0;p<v.length;p+=2){var S=v[p],x=v[p+1];if(S>E||x<w)continue;if(S<=w&&x>=E||w<=S&&E>=x||Math.min(E,x)-Math.max(w,S)>=E-w>>1){v[p]=Math.min(w,S),v[p+1]=Math.max(E,x);break}}p==v.length&&v.push(w,E),m[l]={left:b.left-d.left,right:b.right-d.left,top:p}}for(var l=0,y;l<m.length;++l)if(y=m[l]){var T=y.top;y.top=v[T],y.bottom=v[T+1]}return m}function tt(e){e.display.measureLineCache.length=e.display.measureLineCachePos=0,e.display.cachedCharWidth=e.display.cachedTextHeight=null,e.view.maxLineChanged=!0}function nt(e,t,n,r){if(t.widgets)for(var i=0;i<t.widgets.length;++i)if(t.widgets[i].above){var s=t.widgets[i].node.offsetHeight;n.top+=s,n.bottom+=s}if(r=="line")return n;r||(r="local");var o=Sr(e,t);r!="local"&&(o-=e.display.viewOffset);if(r=="page"){var u=e.display.lineSpace.getBoundingClientRect();o+=u.top+(window.pageYOffset||(document.documentElement||document.body).scrollTop);var a=u.left+(window.pageXOffset||(document.documentElement||document.body).scrollLeft);n.left+=a,n.right+=a}return n.top+=o,n.bottom+=o,n}function rt(e,t,n,r){return r||(r=yr(e.view.doc,t.line)),nt(e,r,Y(e,r,t.ch),n)}function it(e,t,n,r,i){function s(t,s){var o=Y(e,r,t,i);return s?o.left=o.right:o.right=o.left,nt(e,r,o,n)}r=r||yr(e.view.doc,t.line),i||(i=Z(e,r));var o=xr(r),u=t.ch;if(!o)return s(u);var a,f,l=o[0].level;for(var c=0;c<o.length;++c){var h=o[c],p=h.level%2,d,v;if(h.from<u&&h.to>u)return s(u,p);var m=p?h.to:h.from,g=p?h.from:h.to;if(m==u)c&&h.level<(d=o[c-1]).level?v=s(d.level%2?d.from:d.to-1,!0):v=s(p&&h.from!=h.to?u-1:u),p==l?a=v:f=v;else if(g==u){var d=c<o.length-1&&o[c+1];if(!p&&d&&d.from==d.to)continue;d&&h.level<d.level?v=s(d.level%2?d.to-1:d.from):v=s(p?u:u-1,!0),p==l?a=v:f=v}}return l&&!u&&(f=s(o[0].to-1)),a?(f&&(a.other=f),a):f}function st(e,t,n){var r=e.view.doc;n+=e.display.viewOffset;if(n<0)return{line:0,ch:0,outside:!0};var i=Er(r,n);if(i>=r.size)return{line:r.size-1,ch:yr(r,r.size-1).text.length};t<0&&(t=0);for(;;){var s=yr(r,i),o=ot(e,s,i,t,n),u=Jn(s);if(!u||o.ch!=yi(s))return o;i=u.find().to.line}}function ot(e,t,n,r,i){function f(r){var i=it(e,{line:n,ch:r},"line",t,a);return o=!0,s>i.bottom?Math.max(0,i.left-u):s<i.top?i.left+u:(o=!1,i.left)}var s=i-Sr(e,t),o=!1,u=e.display.wrapper.clientWidth,a=Z(e,t),l=xr(t),c=t.text.length,h=gi(t),p=yi(t),d=G(e.display),v=f(p);if(r>v)return{line:n,ch:p,outside:o};for(;;){if(l?p==h||p==Ei(t,h,1):p-h<=1){var m=r-d<v-r,g=m?h:p;while(Zr.test(t.text.charAt(g)))++g;return{line:n,ch:g,after:m,outside:o}}var y=Math.ceil(c/2),b=h+y;if(l){b=h;for(var w=0;w<y;++w)b=Ei(t,b,1)}var E=f(b);E>r?(p=b,v=E,o&&(v+=1e3),c-=y):(h=b,d=E,c=y)}}function at(e){if(e.cachedTextHeight!=null)return e.cachedTextHeight;if(ut==null){ut=ei("pre");for(var t=0;t<49;++t)ut.appendChild(document.createTextNode("x")),ut.appendChild(ei("br"));ut.appendChild(document.createTextNode("x"))}ni(e.measure,ut);var n=ut.offsetHeight/50;return n>3&&(e.cachedTextHeight=n),ti(e.measure),n||1}function ft(e){if(e.cachedCharWidth!=null)return e.cachedCharWidth;var t=ei("span","x"),n=ei("pre",[t]);ni(e.measure,n);var r=t.offsetWidth;return r>2&&(e.cachedCharWidth=r),r||10}function lt(e){e.curOp?++e.curOp.depth:e.curOp={depth:1,changes:[],delayedCallbacks:[],updateInput:null,userSelChange:null,textChanged:null,selectionChanged:!1,updateMaxLine:!1,id:++e.nextOpId}}function ct(e){var t=e.curOp;if(--t.depth)return;e.curOp=null;var n=e.view,r=e.display;t.updateMaxLine&&L(n);if(n.maxLineChanged&&!e.options.lineWrapping){var i=Y(e,n.maxLine,n.maxLine.text.length).right;r.sizer.style.minWidth=i+3+Ir+"px",n.maxLineChanged=!1}var s,o;if(t.selectionChanged){var u=it(e,n.sel.head);s=vn(e,u.left,u.top,u.left,u.bottom)}if(t.changes.length||s&&s.scrollTop!=null)o=B(e,t.changes,s&&s.scrollTop);!o&&t.selectionChanged&&U(e),s&&hn(e),t.selectionChanged&&X(e),n.focused&&t.updateInput&&gt(e,t.userSelChange),t.textChanged&&Br(e,"change",e,t.textChanged),t.selectionChanged&&Br(e,"cursorActivity",e);for(var a=0;a<t.delayedCallbacks.length;++a)t.delayedCallbacks[a](e)}function ht(e,t){return function(){var n=e||this;lt(n);try{var r=t.apply(n,arguments)}finally{ct(n)}return r}}function pt(e,t,n,r){e.curOp.changes.push({from:t,to:n,diff:r})}function dt(e){if(e.view.pollingFast)return;e.display.poll.set(e.options.pollInterval,function(){mt(e),e.view.focused&&dt(e)})}function vt(e){function n(){var r=mt(e);!r&&!t?(t=!0,e.display.poll.set(60,n)):(e.display.pollingFast=!1,dt(e))}var t=!1;e.display.pollingFast=!0,e.display.poll.set(20,n)}function mt(e){var t=e.display.input,n=e.display.prevInput,r=e.view,i=r.sel;if(!r.focused||ci(t)||bt(e))return!1;var s=t.value;if(s==n&&tn(i.from,i.to))return!1;lt(e),r.sel.shift=!1;var o=0,u=Math.min(n.length,s.length);while(o<u&&n[o]==s[o])++o;var a=i.from,f=i.to;o<n.length?a={line:a.line,ch:a.ch-(n.length-o)}:r.overwrite&&tn(a,f)&&!e.display.pasteIncoming&&(f={line:f.line,ch:Math.min(yr(e.view.doc,f.line).text.length,f.ch+(s.length-o))});var l=e.curOp.updateInput;return Qt(e,a,f,li(s.slice(o)),"end",e.display.pasteIncoming?"paste":"input",{from:a,to:f}),e.curOp.updateInput=l,s.length>1e3?t.value=e.display.prevInput="":e.display.prevInput=s,ct(e),e.display.pasteIncoming=!1,!0}function gt(e,t){var n=e.view,r,i;tn(n.sel.from,n.sel.to)?t&&(e.display.prevInput=e.display.input.value=""):(e.display.prevInput="",r=hi&&(n.sel.to.line-n.sel.from.line>100||(i=e.getSelection()).length>1e3),r?e.display.input.value="-":e.display.input.value=i||e.getSelection(),n.focused&&Vr(e.display.input)),e.display.inaccurateSelection=r}function yt(e){e.options.readOnly!="nocursor"&&(t||document.activeElement!=e.display.input)&&e.display.input.focus()}function bt(e){return e.options.readOnly||e.view.cantEdit}function wt(t){function r(){t.view.focused&&setTimeout(Kr(yt,t),0)}function i(e){if(t.options.onDragEvent&&t.options.onDragEvent(t,kr(e)))return;Or(e)}function s(){n.inaccurateSelection&&(n.prevInput="",n.inaccurateSelection=!1,n.input.value=t.getSelection(),Vr(n.input))}var n=t.display;Pr(n.scroller,"mousedown",ht(t,Nt)),Pr(n.scroller,"dblclick",ht(t,Lr)),Pr(n.lineSpace,"selectstart",function(e){Et(n,e)||Lr(e)}),e||Pr(n.scroller,"contextmenu",function(e){Kt(t,e)}),Pr(n.scroller,"scroll",function(){At(t,n.scroller.scrollTop),Ot(t,n.scroller.scrollLeft,!0),Br(t,"scroll",t)}),Pr(n.scrollbarV,"scroll",function(){At(t,n.scrollbarV.scrollTop)}),Pr(n.scrollbarH,"scroll",function(){Ot(t,n.scrollbarH.scrollLeft)}),Pr(n.scroller,"mousewheel",function(e){jt(t,e)}),Pr(n.scroller,"DOMMouseScroll",function(e){jt(t,e)}),Pr(n.scrollbarH,"mousedown",r),Pr(n.scrollbarV,"mousedown",r),Pr(n.wrapper,"scroll",function(){n.wrapper.scrollTop=n.wrapper.scrollLeft=0}),Pr(window,"resize",function o(){n.cachedCharWidth=n.cachedTextHeight=null,tt(t),n.wrapper.parentNode?B(t,!0):Hr(window,"resize",o)}),Pr(n.input,"keyup",ht(t,function(e){if(t.options.onKeyEvent&&t.options.onKeyEvent(t,kr(e)))return;Dr(e,"keyCode")==16&&(t.view.sel.shift=!1)})),Pr(n.input,"input",Kr(vt,t)),Pr(n.input,"keydown",ht(t,Wt)),Pr(n.input,"keypress",ht(t,Xt)),Pr(n.input,"focus",Kr(Vt,t)),Pr(n.input,"blur",Kr($t,t)),t.options.dragDrop&&(Pr(n.scroller,"dragstart",function(e){Lt(t,e)}),Pr(n.scroller,"dragenter",i),Pr(n.scroller,"dragover",i),Pr(n.scroller,"drop",ht(t,Ct))),Pr(n.scroller,"paste",function(){yt(t),vt(t)}),Pr(n.input,"paste",function(){n.pasteIncoming=!0,vt(t)}),Pr(n.input,"cut",s),Pr(n.input,"copy",s),f&&Pr(n.sizer,"mouseup",function(){document.activeElement==n.input&&n.input.blur(),yt(t)})}function Et(e,t){for(var n=Mr(t);n!=e.wrapper;n=n.parentNode)if(/\bCodeMirror-(?:line)?widget\b/.test(n.className)||n.parentNode==e.sizer&&n!=e.mover)return!0}function St(e,t,n){var r=e.display;if(!n){var i=Mr(t);if(i==r.scrollbarH||i==r.scrollbarH.firstChild||i==r.scrollbarV||i==r.scrollbarV.firstChild||i==r.scrollbarFiller)return null}var s,o,u=r.lineSpace.getBoundingClientRect();try{s=t.clientX,o=t.clientY}catch(t){return null}return st(e,s-u.left,o-u.top)}function Nt(n){function g(e){if(c=="single"){an(r,on(a,f),e);return}v=on(a,v),m=on(a,m);if(c=="double"){var t=bn(yr(a,e.line).text,e);nn(e,v)?an(r,t.from,m):an(r,v,t.to)}else c=="triple"&&(nn(e,v)?an(r,m,on(a,{line:e.line,ch:0})):an(r,v,on(a,{line:e.line+1,ch:0})))}function w(e){var t=++b,n=St(r,e,!0);if(!n)return;if(!tn(n,p)){o.focused||Vt(r),p=n,g(n);var i=M(s,a);(n.line>=i.to||n.line<i.from)&&setTimeout(ht(r,function(){b==t&&w(e)}),150)}else{var u=e.clientY<y.top?-20:e.clientY>y.bottom?20:0;u&&setTimeout(ht(r,function(){if(b!=t)return;s.scroller.scrollTop+=u,w(e)}),50)}}function E(e){b=Infinity;var t=St(r,e);t&&g(t),Lr(e),yt(r),Hr(document,"mousemove",S),Hr(document,"mouseup",x)}var r=this,s=r.display,o=r.view,u=o.sel,a=o.doc;u.shift=Dr(n,"shiftKey");if(Et(s,n)){i||(s.scroller.draggable=!1,setTimeout(function(){s.scroller.draggable=!0},100));return}if(kt(r,n))return;var f=St(r,n);switch(_r(n)){case 3:e&&Kt.call(r,r,n);return;case 2:f&&an(r,f),setTimeout(Kr(yt,r),20),Lr(n);return}if(!f){Mr(n)==s.scroller&&Lr(n);return}o.focused||Vt(r);var l=+(new Date),c="single";if(Tt&&Tt.time>l-400&&tn(Tt.pos,f))c="triple",Lr(n),setTimeout(Kr(yt,r),20),wn(r,f.line);else if(xt&&xt.time>l-400&&tn(xt.pos,f)){c="double",Tt={time:l,pos:f},Lr(n);var h=bn(yr(a,f.line).text,f);an(r,h.from,h.to)}else xt={time:l,pos:f};var p=f;if(r.options.dragDrop&&ii&&!bt(r)&&!tn(u.from,u.to)&&!nn(f,u.from)&&!nn(u.to,f)&&c=="single"){var d=ht(r,function(e){i&&(s.scroller.draggable=!1),o.draggingText=!1,Hr(document,"mouseup",d),Hr(s.scroller,"drop",d),Math.abs(n.clientX-e.clientX)+Math.abs(n.clientY-e.clientY)<10&&(Lr(e),an(r,f),yt(r))});i&&(s.scroller.draggable=!0),o.draggingText=d,s.scroller.dragDrop&&s.scroller.dragDrop(),Pr(document,"mouseup",d),Pr(s.scroller,"drop",d);return}Lr(n),c=="single"&&an(r,on(a,f));var v=u.from,m=u.to,y=s.wrapper.getBoundingClientRect(),b=0,S=ht(r,function(e){!t&&!_r(e)?E(e):w(e)}),x=ht(r,E);Pr(document,"mousemove",S),Pr(document,"mouseup",x)}function Ct(e){var n=this;if(n.options.onDragEvent&&n.options.onDragEvent(n,kr(e)))return;Lr(e);var r=St(n,e,!0),i=e.dataTransfer.files;if(!r||bt(n))return;if(i&&i.length&&window.FileReader&&window.File){var s=i.length,o=Array(s),u=0,a=function(e,t){var i=new FileReader;i.onload=function(){o[t]=i.result,++u==s&&(r=on(n.view.doc,r),ht(n,function(){var e=en(n,o.join(""),r,r,"paste");fn(n,r,e)})())},i.readAsText(e)};for(var f=0;f<s;++f)a(i[f],f)}else{if(n.view.draggingText&&!nn(r,n.view.sel.from)&&!nn(n.view.sel.to,r)){n.view.draggingText(e),t&&setTimeout(Kr(yt,n),50);return}try{var o=e.dataTransfer.getData("Text");if(o){var l=n.view.sel.from,c=n.view.sel.to;fn(n,r,r),n.view.draggingText&&en(n,"",l,c,"paste"),n.replaceSelection(o,null,"paste"),yt(n),Vt(n)}}catch(e){}}}function kt(e,t){var n=e.display;try{var r=t.clientX,i=t.clientY}catch(t){return!1}if(r>=Math.floor(n.gutters.getBoundingClientRect().right))return!1;Lr(t);if(!Fr(e,"gutterClick"))return!0;var s=n.lineDiv.getBoundingClientRect();if(i>s.bottom)return!0;i-=s.top-n.viewOffset;for(var o=0;o<e.options.gutters.length;++o){var u=n.gutters.childNodes[o];if(u&&u.getBoundingClientRect().right>=r){var a=Er(e.view.doc,i),f=e.options.gutters[o];jr(e,e,"gutterClick",e,a,f,t);break}}return!0}function Lt(e,t){var n=e.getSelection();t.dataTransfer.setData("Text",n),t.dataTransfer.setDragImage&&!a&&t.dataTransfer.setDragImage(ei("img"),0,0)}function At(t,n){if(Math.abs(t.view.scrollTop-n)<2)return;t.view.scrollTop=n,e||B(t,[],n),t.display.scroller.scrollTop!=n&&(t.display.scroller.scrollTop=n),t.display.scrollbarV.scrollTop!=n&&(t.display.scrollbarV.scrollTop=n),e&&B(t,[])}function Ot(e,t,n){if(n?t==e.view.scrollLeft:Math.abs(e.view.scrollLeft-t)<2)return;e.view.scrollLeft=t,_(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t)}function jt(t,n){var r=n.wheelDeltaX,s=n.wheelDeltaY;r==null&&n.detail&&n.axis==n.HORIZONTAL_AXIS&&(r=n.detail),s==null&&n.detail&&n.axis==n.VERTICAL_AXIS?s=n.detail:s==null&&(s=n.wheelDelta);if(s&&v&&i)for(var o=n.target;o!=a;o=o.parentNode)if(o.lineObj){t.display.currentWheelTarget=o;break}var a=t.display.scroller;if(r&&!e&&!u&&Bt!=null){s&&At(t,Math.max(0,Math.min(a.scrollTop+s*Bt,a.scrollHeight-a.clientHeight))),Ot(t,Math.max(0,Math.min(a.scrollLeft+r*Bt,a.scrollWidth-a.clientWidth))),Lr(n),Pt=null;return}if(s&&Bt!=null){var f=s*Bt,l=t.view.scrollTop,c=l+t.display.wrapper.clientHeight;f<0?l=Math.max(0,l+f-50):c=Math.min(t.view.doc.height,c+f+50),B(t,[],{top:l,bottom:c})}Mt<20&&(Pt==null?(Pt=a.scrollLeft,Ht=a.scrollTop,_t=r,Dt=s,setTimeout(function(){if(Pt==null)return;var e=a.scrollLeft-Pt,t=a.scrollTop-Ht,n=t&&Dt&&t/Dt||e&&_t&&e/_t;Pt=Ht=null;if(!n)return;Bt=(Bt*Mt+n)/(Mt+1),++Mt},200)):(_t+=r,Dt+=s))}function Ft(e,t,n){if(typeof t=="string"){t=Mn[t];if(!t)return!1}e.display.pollingFast&&mt(e)&&(e.display.pollingFast=!1);var r=e.view,i=r.sel.shift;try{bt(e)&&(r.suppressEdits=!0),n&&(r.sel.shift=!1),t(e)}catch(s){if(s!=qr)throw s;return!1}finally{r.sel.shift=i,r.suppressEdits=!1}return!0}function It(e){var t=e.view.keyMaps.slice(0);return t.push(e.options.keyMap),e.options.extraKeys&&t.unshift(e.options.extraKeys),t}function Rt(e,t){function c(){l=!0}var n=Dn(e.options.keyMap),i=n.auto;clearTimeout(qt),i&&!Hn(t)&&(qt=setTimeout(function(){Dn(e.options.keyMap)==n&&(e.options.keyMap=i.call?i.call(null,e):i)},50));var o=pi[Dr(t,"keyCode")],a=!1,f=v&&(u||s);if(o==null||t.altGraphKey)return!1;Dr(t,"altKey")&&(o="Alt-"+o),Dr(t,f?"metaKey":"ctrlKey")&&(o="Ctrl-"+o),Dr(t,f?"ctrlKey":"metaKey")&&(o="Cmd-"+o);var l=!1,h=It(e);return Dr(t,"shiftKey")?a=Pn("Shift-"+o,h,function(t){return Ft(e,t,!0)},c)||Pn(o,h,function(t){if(typeof t=="string"&&/^go[A-Z]/.test(t))return Ft(e,t)},c):a=Pn(o,h,function(t){return Ft(e,t)},c),l&&(a=!1),a&&(Lr(t),X(e),r&&(t.oldKeyCode=t.keyCode,t.keyCode=0)),a}function Ut(e,t,n){var r=Pn("'"+n+"'",It(e),function(t){return Ft(e,t,!0)});return r&&(Lr(t),X(e)),r}function Wt(e){var n=this;n.view.focused||Vt(n),t&&e.keyCode==27&&(e.returnValue=!1);if(n.options.onKeyEvent&&n.options.onKeyEvent(n,kr(e)))return;var r=Dr(e,"keyCode");n.view.sel.shift=r==16||Dr(e,"shiftKey");var i=Rt(n,e);u&&(zt=i?r:null,!i&&r==88&&!hi&&Dr(e,v?"metaKey":"ctrlKey")&&n.replaceSelection(""))}function Xt(e){var t=this;if(t.options.onKeyEvent&&t.options.onKeyEvent(t,kr(e)))return;var n=Dr(e,"keyCode"),r=Dr(e,"charCode");if(u&&n==zt){zt=null,Lr(e);return}if((u&&(!e.which||e.which<10)||f)&&Rt(t,e))return;var i=String.fromCharCode(r==null?n:r);this.options.electricChars&&this.view.mode.electricChars&&this.options.smartIndent&&!bt(this)&&this.view.mode.electricChars.indexOf(i)>-1&&setTimeout(ht(t,function(){mn(t,t.view.sel.to.line,"smart")}),75);if(Ut(t,e,i))return;vt(t)}function Vt(e){if(e.options.readOnly=="nocursor")return;e.view.focused||(Br(e,"focus",e),e.view.focused=!0,e.display.scroller.className.search(/\bCodeMirror-focused\b/)==-1&&(e.display.scroller.className+=" CodeMirror-focused"),gt(e,!0)),dt(e),X(e)}function $t(e){e.view.focused&&(Br(e,"blur",e),e.view.focused=!1,e.display.scroller.className=e.display.scroller.className.replace(" CodeMirror-focused","")),clearInterval(e.display.blinker),setTimeout(function(){e.view.focused||(e.view.sel.shift=!1)},150)}function Kt(t,n){function l(){i.inputDiv.style.position="relative",i.input.style.cssText=f,r&&(i.scrollbarV.scrollTop=i.scroller.scrollTop=a),dt(t);if(i.input.selectionStart!=null){clearTimeout(Jt);var e=i.input.value=" "+(tn(s.from,s.to)?"":i.input.value),n=0;i.prevInput=" ",i.input.selectionStart=1,i.input.selectionEnd=e.length,Jt=setTimeout(function o(){i.prevInput==" "&&i.input.selectionStart==0?ht(t,Mn.selectAll)(t):n++<10?Jt=setTimeout(o,500):gt(t)},200)}}var i=t.display,s=t.view.sel,o=St(t,n),a=i.scroller.scrollTop;if(!o||u)return;(tn(s.from,s.to)||nn(o,s.from)||!nn(o,s.to))&&ht(t,fn)(t,o,o);var f=i.input.style.cssText;i.inputDiv.style.position="absolute",i.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(n.clientY-5)+"px; left: "+(n.clientX-5)+"px; z-index: 1000; background: white; outline: none;"+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",yt(t),gt(t,!0),tn(s.from,s.to)&&(i.input.value=i.prevInput=" "),e?(Or(n),Pr(window,"mouseup",function c(){Hr(window,"mouseup",c),setTimeout(l,20)})):setTimeout(l,50)}function Qt(e,t,n,r,i,s){var o=m&&Xn(e.view.doc,t,n);if(!o)return Gt(e,t,n,r,i,s);for(var u=o.length-1;u>=1;--u)Gt(e,o[u].from,o[u].to,[""],s);if(o.length)return Gt(e,o[0].from,o[0].to,r,i,s)}function Gt(e,t,n,r,i,s){if(e.view.suppressEdits)return;var o=e.view,u=o.doc,a=[];u.iter(t.line,n.line+1,function(e){a.push(er(e.text,e.markedSpans))});var f=o.sel.from,l=o.sel.to,c=Wn(Zn(a[0]),Zn(Xr(a)),t.ch,n.ch,r),h=Zt(e,t,n,c,i,s);return o.history&&Nr(e,t.line,r.length,a,s,f,l,o.sel.from,o.sel.to),h}function Yt(e,t){var n=e.view.doc,r=e.view.history,i=(t=="undo"?r.done:r.undone).pop();if(!i)return;var s={events:[],fromBefore:i.fromAfter,toBefore:i.toAfter,fromAfter:i.fromBefore,toAfter:i.toBefore};for(var o=i.events.length-1;o>=0;o-=1){r.dirtyCounter+=t=="undo"?-1:1;var u=i.events[o],a=[],f=u.start+u.added;n.iter(u.start,f,function(e){a.push(er(e.text,e.markedSpans))}),s.events.push({start:u.start,added:u.old.length,old:a});var l=o?null:{from:i.fromBefore,to:i.toBefore};Zt(e,{line:u.start,ch:0},{line:f-1,ch:yr(n,f-1).text.length},u.old,l,t)}(t=="undo"?r.undone:r.done).push(s)}function Zt(e,t,n,r,i,s){var o=e.view,u=o.doc,a=e.display;if(o.suppressEdits)return;var f=n.line-t.line,l=yr(u,t.line),c=yr(u,n.line),h=!1,p=t.line;e.options.lineWrapping||(p=wr(Kn(u,l)),u.iter(p,n.line+1,function(e){if(k(u,e)==o.maxLineLength)return h=!0,!0}));var d=Xr(r),v=at(a);if(t.ch==0&&n.ch==0&&Yn(d)==""){var m=[];for(var g=0,y=r.length-1;g<y;++g)m.push(rr(Yn(r[g]),Zn(r[g]),v));ir(e,c,c.text,Zn(d)),f&&u.remove(t.line,f,e),m.length&&u.insert(t.line,m)}else if(l==c)if(r.length==1)ir(e,l,l.text.slice(0,t.ch)+Yn(r[0])+l.text.slice(n.ch),Zn(r[0]));else{for(var m=[],g=1,y=r.length-1;g<y;++g)m.push(rr(Yn(r[g]),Zn(r[g]),v));m.push(rr(Yn(d)+l.text.slice(n.ch),Zn(d),v)),ir(e,l,l.text.slice(0,t.ch)+Yn(r[0]),Zn(r[0])),u.insert(t.line+1,m)}else if(r.length==1)ir(e,l,l.text.slice(0,t.ch)+Yn(r[0])+c.text.slice(n.ch),Zn(r[0])),u.remove(t.line+1,f,e);else{var m=[];ir(e,l,l.text.slice(0,t.ch)+Yn(r[0]),Zn(r[0])),ir(e,c,Yn(d)+c.text.slice(n.ch),Zn(d));for(var g=1,y=r.length-1;g<y;++g)m.push(rr(Yn(r[g]),Zn(r[g]),v));f>1&&u.remove(t.line+1,f-1,e),u.insert(t.line+1,m)}if(e.options.lineWrapping){var b=Math.max(5,a.scroller.clientWidth/ft(a)-3);u.iter(t.line,t.line+r.length,function(e){if(e.height==0)return;var t=(Math.ceil(e.text.length/b)||1)*v;t!=e.height&&br(e,t)})}else u.iter(p,t.line+r.length,function(e){var t=k(u,e);t>o.maxLineLength&&(o.maxLine=e,o.maxLineLength=t,o.maxLineChanged=!0,h=!1)}),h&&(e.curOp.updateMaxLine=!0);o.frontier=Math.min(o.frontier,t.line),V(e,400);var w=r.length-f-1;pt(e,t.line,n.line+1,w);if(Fr(e,"change")){for(var g=0;g<r.length;++g)typeof r[g]!="string"&&(r[g]=r[g].text);var E={from:t,to:n,text:r,origin:s};if(e.curOp.textChanged){for(var S=e.curOp.textChanged;S.next;S=S.next);S.next=E}else e.curOp.textChanged=E}var x,T,N={line:t.line+r.length-1,ch:Yn(d).length+(r.length==1?t.ch:0)};if(i&&typeof i!="string")i.from?(x=i.from,T=i.to):x=T=i;else if(i=="end")x=T=N;else if(i=="start")x=T=t;else if(i=="around")x=t,T=N;else{var C=function(e){if(nn(e,t))return e;if(!nn(n,e))return N;var r=e.line+w,i=e.ch;return e.line==n.line&&(i+=Yn(d).length-(n.ch-(n.line==t.line?t.ch:0))),{line:r,ch:i}};x=C(o.sel.from),T=C(o.sel.to)}return fn(e,x,T,null,!0),N}function en(e,t,n,r,i){r||(r=n);if(nn(r,n)){var s=r;r=n,n=s}return Qt(e,n,r,li(t),null,i)}function tn(e,t){return e.line==t.line&&e.ch==t.ch}function nn(e,t){return e.line<t.line||e.line==t.line&&e.ch<t.ch}function rn(e){return{line:e.line,ch:e.ch}}function sn(e,t){return Math.max(0,Math.min(t,e.size-1))}function on(e,t){if(t.line<0)return{line:0,ch:0};if(t.line>=e.size)return{line:e.size-1,ch:yr(e,e.size-1).text.length};var n=t.ch,r=yr(e,t.line).text.length;return n==null||n>r?{line:t.line,ch:r}:n<0?{line:t.line,ch:0}:t}function un(e,t){return t>=0&&t<e.size}function an(e,t,n,r){var i=e.view.sel;if(i.shift||i.extend){var s=i.anchor;if(n){var o=nn(t,s);o!=nn(n,s)?(s=t,t=n):o!=nn(t,n)&&(t=n)}fn(e,s,t,r)}else fn(e,t,n||t,r);e.curOp.userSelChange=!0}function fn(e,t,n,r,i){e.view.goalColumn=null;var s=e.view.sel;if(i||!tn(t,s.anchor))t=cn(e,t,r,i!="push");if(i||!tn(n,s.head))n=cn(e,n,r,i!="push");if(tn(s.anchor,t)&&tn(s.head,n))return;s.anchor=t,s.head=n;var o=nn(n,t);s.from=o?n:t,s.to=o?t:n,e.curOp.updateInput=!0,e.curOp.selectionChanged=!0}function ln(e){fn(e,e.view.sel.from,e.view.sel.to,null,"push")}function cn(e,t,n,r){var i=e.view.doc,s=!1,o=t,u=n||1;e.view.cantEdit=!1;e:for(;;){var a=yr(i,o.line),f;if(a.markedSpans){for(var l=0;l<a.markedSpans.length;++l){var c=a.markedSpans[l],h=c.marker;if((c.from==null||(h.inclusiveLeft?c.from<=o.ch:c.from<o.ch))&&(c.to==null||(h.inclusiveRight?c.to>=o.ch:c.to>o.ch))){if(r&&h.clearOnEnter){(f||(f=[])).push(h);continue}if(!h.atomic)continue;var p=h.find()[u<0?"from":"to"];if(tn(p,o)){p.ch+=u,p.ch<0?p.line?p=on(i,{line:p.line-1}):p=null:p.ch>a.text.length&&(p.line<i.size-1?p={line:p.line+1,ch:0}:p=null);if(!p){if(s)return r?(e.view.cantEdit=!0,{line:0,ch:0}):cn(e,t,n,!0);s=!0,p=t,u=-u}}o=p;continue e}}if(f)for(var l=0;l<f.length;++l)f[l].clear()}return o}}function hn(e){var t=e.view,n=pn(e,t.sel.head);if(!t.focused)return;var r=e.display,i=r.sizer.getBoundingClientRect(),s=null;n.top+i.top<0?s=!0:n.bottom+i.top>(window.innerHeight||document.documentElement.clientHeight)&&(s=!1);if(s!=null&&!h){var o=r.cursor.style.display=="none";o&&(r.cursor.style.display="",r.cursor.style.left=n.left+"px",r.cursor.style.top=n.top-r.viewOffset+"px"),r.cursor.scrollIntoView(s),o&&(r.cursor.style.display="none")}}function pn(e,t){for(;;){var n=!1,r=it(e,t),i=vn(e,r.left,r.top,r.left,r.bottom),s=e.view.scrollTop,o=e.view.scrollLeft;i.scrollTop!=null&&(At(e,i.scrollTop),Math.abs(e.view.scrollTop-s)>1&&(n=!0)),i.scrollLeft!=null&&(Ot(e,i.scrollLeft),Math.abs(e.view.scrollLeft-o)>1&&(n=!0));if(!n)return r}}function dn(e,t,n,r,i){var s=vn(e,t,n,r,i);s.scrollTop!=null&&At(e,s.scrollTop),s.scrollLeft!=null&&Ot(e,s.scrollLeft)}function vn(e,t,n,r,i){var s=e.display,o=Q(s);n+=o,i+=o;var u=s.scroller.clientHeight-Ir,a=s.scroller.scrollTop,f={},l=e.view.doc.height+2*o,c=n<o+10,h=i+o>l-10;n<a?f.scrollTop=c?0:Math.max(0,n):i>a+u&&(f.scrollTop=(h?l:i)-u);var p=s.scroller.clientWidth-Ir,d=s.scroller.scrollLeft;t+=s.gutters.offsetWidth,r+=s.gutters.offsetWidth;var v=s.gutters.offsetWidth,m=t<v+10;return t<d+v||m?(m&&(t=0),f.scrollLeft=Math.max(0,t-10-v)):r>p+d-3&&(f.scrollLeft=r+10-p),f}function mn(e,t,n,r){var i=e.view.doc;n||(n="add");if(n=="smart")if(!e.view.mode.indent)n="prev";else var s=K(e,t);var o=e.options.tabSize,u=yr(i,t),a=Ur(u.text,null,o),f=u.text.match(/^\s*/)[0],l;if(n=="smart"){l=e.view.mode.indent(s,u.text.slice(f.length),u.text);if(l==qr){if(!r)return;n="prev"}}n=="prev"?t?l=Ur(yr(i,t-1).text,null,o):l=0:n=="add"?l=a+e.options.indentUnit:n=="subtract"&&(l=a-e.options.indentUnit),l=Math.max(0,l);var c="",h=0;if(e.options.indentWithTabs)for(var p=Math.floor(l/o);p;--p)h+=o,c+="	";h<l&&(c+=Wr(l-h)),c!=f&&en(e,c,{line:t,ch:0},{line:t,ch:f.length},"input"),u.stateAfter=null}function gn(e,t,n){var r=t,i=t,s=e.view.doc;return typeof t=="number"?i=yr(s,sn(s,t)):r=wr(t),r==null?null:n(i,r)?(pt(e,r,r+1),i):null}function yn(e,t,n,r){function f(){var e=o+t;return e<0||e==i.size?!1:(o=e,a=yr(i,e))}function l(e){var n=(r?Ei:Si)(a,u,t,!0);if(n==null){if(!!e||!f())return!1;r?u=(t<0?yi:gi)(a):u=t<0?a.text.length:0}else u=n;return!0}var i=e.view.doc,s=e.view.sel.head,o=s.line,u=s.ch,a=yr(i,o);if(n=="char")l();else if(n=="column")l(!0);else if(n=="word"){var c=!1;for(;;){if(t<0&&!l())break;if(Gr(a.text.charAt(u)))c=!0;else if(c){t<0&&(t=1,l());break}if(t>0&&!l())break}}return cn(e,{line:o,ch:u},t,!0)}function bn(e,t){var n=t.ch,r=t.ch;if(e){t.after===!1||r==e.length?--n:++r;var i=e.charAt(n),s=Gr(i)?Gr:/\s/.test(i)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!Gr(e)};while(n>0&&s(e.charAt(n-1)))--n;while(r<e.length&&s(e.charAt(r)))++r}return{from:{line:t.line,ch:n},to:{line:t.line,ch:r}}}function wn(e,t){an(e,{line:t,ch:0},on(e.view.doc,{line:t+1,ch:0}))}function xn(e,t,n,r){y.defaults[e]=t,n&&(En[e]=r?function(e,t,r){r!=Tn&&n(e,t,r)}:n)}function An(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var n={};for(var r in t){var i=t[r];i instanceof Array&&(i=i.concat([])),n[r]=i}return n}function On(e,t,n){return e.startState?e.startState(t,n):!0}function Dn(e){return typeof e=="string"?_n[e]:e}function Pn(e,t,n,r){function i(t){t=Dn(t);var s=t[e];if(s===!1)return r&&r(),!0;if(s!=null&&n(s))return!0;if(t.nofallthrough)return r&&r(),!0;var o=t.fallthrough;if(o==null)return!1;if(Object.prototype.toString.call(o)!="[object Array]")return i(o);for(var u=0,a=o.length;u<a;++u)if(i(o[u]))return!0;return!1}for(var s=0;s<t.length;++s)if(i(t[s]))return!0}function Hn(e){var t=pi[Dr(e,"keyCode")];return t=="Ctrl"||t=="Alt"||t=="Shift"||t=="Mod"}function Bn(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8}function jn(e,t){this.lines=[],this.type=t,this.cm=e}function Fn(e,t,n,r,i){var s=e.view.doc,o=new jn(e,i);if(i=="range"&&!nn(t,n))return o;if(r)for(var u in r)r.hasOwnProperty(u)&&(o[u]=r[u]);o.replacedWith&&(o.collapsed=!0,o.replacedWith=ei("span",[o.replacedWith],"CodeMirror-widget")),o.collapsed&&(g=!0);var a=t.line,f=0,l,c;s.iter(a,n.line+1,function(e){var r={from:null,to:null,marker:o};f+=e.text.length,a==t.line&&(r.from=t.ch,f-=t.ch),a==n.line&&(r.to=n.ch,f-=e.text.length-n.ch),o.collapsed&&(a==n.line&&(c=Vn(e,n.ch)),a==t.line?l=Vn(e,t.ch):br(e,0)),Rn(e,r),o.collapsed&&a==t.line&&Qn(e)&&br(e,0),++a}),o.readOnly&&(m=!0,(e.view.history.done.length||e.view.history.undone.length)&&e.clearHistory());if(o.collapsed){if(l!=c)throw new Error("Inserting collapsed marker overlapping an existing one");o.size=f,o.atomic=!0}return(o.className||o.startStyle||o.endStyle||o.collapsed)&&pt(e,t.line,n.line+1),o.atomic&&ln(e),o}function In(e,t){if(e)for(var n=0;n<e.length;++n){var r=e[n];if(r.marker==t)return r}}function qn(e,t){for(var n,r=0;r<e.length;++r)e[r]!=t&&(n||(n=[])).push(e[r]);return n}function Rn(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.lines.push(e)}function Un(e,t){if(e)for(var n=0,r;n<e.length;++n){var i=e[n],s=i.marker,o=i.from==null||(s.inclusiveLeft?i.from<=t:i.from<t);if(o||s.type=="bookmark"&&i.from==t){var u=i.to==null||(s.inclusiveRight?i.to>=t:i.to>t);(r||(r=[])).push({from:i.from,to:u?null:i.to,marker:s})}}return r}function zn(e,t,n){if(e)for(var r=0,i;r<e.length;++r){var s=e[r],o=s.marker,u=s.to==null||(o.inclusiveRight?s.to>=n:s.to>n);if(u||o.type=="bookmark"&&s.from==n&&s.from!=t){var a=s.from==null||(o.inclusiveLeft?s.from<=n:s.from<n);(i||(i=[])).push({from:a?null:s.from-n,to:s.to==null?null:s.to-n,marker:o})}}return i}function Wn(e,t,n,r,i){if(!e&&!t)return i;var s=Un(e,n),o=zn(t,n,r),u=i.length==1,a=Xr(i).length+(u?n:0);if(s)for(var f=0;f<s.length;++f){var l=s[f];if(l.to==null){var c=In(o,l.marker);c?u&&(l.to=c.to==null?null:c.to+a):l.to=n}}if(o)for(var f=0;f<o.length;++f){var l=o[f];l.to!=null&&(l.to+=a);if(l.from==null){var c=In(s,l.marker);c||(l.from=a,u&&(s||(s=[])).push(l))}else l.from+=a,u&&(s||(s=[])).push(l)}var h=[er(i[0],s)];if(!u){var p=i.length-2,d;if(p>0&&s)for(var f=0;f<s.length;++f)s[f].to==null&&(d||(d=[])).push({from:null,to:null,marker:s[f].marker});for(var f=0;f<p;++f)h.push(er(i[f+1],d));h.push(er(Xr(i),o))}return h}function Xn(e,t,n){var r=null;e.iter(t.line,n.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var n=e.markedSpans[t].marker;n.readOnly&&(!r||$r(r,n)==-1)&&(r||(r=[])).push(n)}});if(!r)return null;var i=[{from:t,to:n}];for(var s=0;s<r.length;++s){var o=r[s].find();for(var u=0;u<i.length;++u){var a=i[u];if(!nn(o.from,a.to)||nn(o.to,a.from))continue;var f=[u,1];nn(a.from,o.from)&&f.push({from:a.from,to:o.from}),nn(o.to,a.to)&&f.push({from:o.to,to:a.to}),i.splice.apply(i,f),u+=f.length-1}}return i}function Vn(e,t){var n=g&&e.markedSpans,r;if(n)for(var i,s=0;s<n.length;++s){i=n[s];if(!i.marker.collapsed)continue;(i.from==null||i.from<t)&&(i.to==null||i.to>t)&&(!r||r.width<i.marker.width)&&(r=i.marker)}return r}function $n(e){return Vn(e,-1)}function Jn(e){return Vn(e,e.text.length+1)}function Kn(e,t){var n;while(n=$n(t))t=yr(e,n.find().from.line);return t}function Qn(e){var t=g&&e.markedSpans;if(t)for(var n,r=0;r<t.length;++r){n=t[r];if(!n.marker.collapsed)continue;if(n.from==null)return!0;if(n.from==0&&n.marker.inclusiveLeft&&Gn(e,n))return!0}}function Gn(e,t){if(t.to==null||t.marker.inclusiveRight&&t.to==e.text.length)return!0;for(var n,r=0;r<e.markedSpans.length;++r){n=e.markedSpans[r];if(n.marker.collapsed&&n.from==t.to&&(n.marker.inclusiveLeft||t.marker.inclusiveRight)&&Gn(e,n))return!0}}function Yn(e){return typeof e=="string"?e:e.text}function Zn(e){if(typeof e=="string")return null;var t=e.markedSpans,n=null;for(var r=0;r<t.length;++r)t[r].marker.explicitlyCleared?n||(n=t.slice(0,r)):n&&n.push(t[r]);return n?n.length?n:null:t}function er(e,t){return t?{text:e,markedSpans:t}:e}function tr(e){var t=e.markedSpans;if(!t)return;for(var n=0;n<t.length;++n){var r=t[n].marker.lines,i=$r(r,e);r.splice(i,1)}e.markedSpans=null}function nr(e,t){if(!t)return;for(var n=0;n<t.length;++n)t[n].marker.lines.push(e);e.markedSpans=t}function rr(e,t,n){var r={text:e,height:n};return nr(r,t),Qn(r)&&(r.height=0),r}function ir(e,t,n,r){t.text=n,t.stateAfter=t.styles=null,t.order!=null&&(t.order=null),tr(t),nr(t,r),Qn(t)?t.height=0:t.height||(t.height=at(e.display)),jr(e,t,"change")}function sr(e){e.parent=null,tr(e)}function or(e,t,n){var r=e.view.mode,i=e.options.flattenSpans,s=!t.styles,o=0,u="",a=null,f=new Bn(t.text,e.options.tabSize),l=t.styles||(t.styles=[]);t.text==""&&r.blankLine&&r.blankLine(n);while(!f.eol()){var c=r.token(f,n),h=f.current();f.start=f.pos,!i||a!=c?(u&&(s=s||o>=l.length||u!=l[o]||a!=l[o+1],l[o++]=u,l[o++]=a),u=h,a=c):u+=h;if(f.pos>5e3)break}return u&&(s=s||o>=l.length||u!=l[o]||a!=l[o+1],l[o++]=u,l[o++]=a),f.pos>5e3&&(l[o++]=t.text.slice(f.pos),l[o++]=null),o!=l.length&&(l.length=o,s=!0),s}function ur(e,t,n){var r=e.view.mode,i=new Bn(t.text,e.options.tabSize);t.text==""&&r.blankLine&&r.blankLine(n);while(!i.eol()&&i.pos<=5e3)r.token(i,n),i.start=i.pos}function fr(e){return e?ar[e]||(ar[e]="cm-"+e.replace(/ +/g," cm-")):null}function lr(e,t,n){var r,i=t,s,o,u=!0;while(r=$n(i))u=!1,i=yr(e.view.doc,r.find().from.line),s||(s=i);var a={pre:ei("pre"),col:0,pos:0,display:!n,measure:null,addedOne:!1,cm:e};i.textClass&&(a.pre.className=i.textClass);do{i.styles||or(e,i,i.stateAfter=K(e,wr(i))),a.measure=i==t&&n,a.pos=0,a.addToken=a.measure?pr:hr,n&&o&&i!=t&&!a.addedOne&&(n[0]=a.pre.appendChild(fi(e.display.measure)),a.addedOne=!0);var f=vr(i,a);o=i==s,f&&(i=yr(e.view.doc,f.to.line),u=!1)}while(f);return n&&!a.addedOne&&(n[0]=a.pre.appendChild(u?ei("span"," "):fi(e.display.measure))),!a.pre.firstChild&&!Qn(t)&&a.pre.appendChild(document.createTextNode(" ")),a.pre}function hr(e,t,n,r,i){if(!t)return;if(!cr.test(t)){e.col+=t.length;var s=document.createTextNode(t)}else{var s=document.createDocumentFragment(),o=0;for(;;){cr.lastIndex=o;var u=cr.exec(t),a=u?u.index-o:t.length-o;a&&(s.appendChild(document.createTextNode(t.slice(o,o+a))),e.col+=a);if(!u)break;o+=a+1;if(u[0]=="	"){var f=e.cm.options.tabSize,l=f-e.col%f;s.appendChild(ei("span",Wr(l),"cm-tab")),e.col+=l}else{var c=ei("span","•","cm-invalidchar");c.title="\\u"+u[0].charCodeAt(0).toString(16),s.appendChild(c),e.col+=1}}}if(n||r||i||e.measure){var h=n||"";return r&&(h+=r),i&&(h+=i),e.pre.appendChild(ei("span",[s],h))}e.pre.appendChild(s)}function pr(e,t,n,r,i){for(var s=0;s<t.length;++s)s&&s<t.length-1&&e.cm.options.lineWrapping&&si.test(t.slice(s-1,s+1))&&e.pre.appendChild(ei("wbr")),e.measure[e.pos++]=hr(e,t.charAt(s),n,s==0&&r,s==t.length-1&&i);t.length&&(e.addedOne=!0)}function dr(e,t,n){n&&(e.display||(n=n.cloneNode(!0)),e.pre.appendChild(n),e.measure&&t&&(e.measure[e.pos]=n,e.addedOne=!0)),e.pos+=t}function vr(e,t){var n=e.styles,r=e.markedSpans;if(!r){for(var i=0;i<n.length;i+=2)t.addToken(t,n[i],fr(n[i+1]));return}var s=e.text,o=s.length,u=0,i=0,a="",f,l=0,c,h,p,d;for(;;){if(l==u){c=h=p="",d=null,l=Infinity;var v=null;for(var m=0;m<r.length;++m){var g=r[m],y=g.marker;g.from<=u&&(g.to==null||g.to>u)?(g.to!=null&&l>g.to&&(l=g.to,h=""),y.className&&(c+=" "+y.className),y.startStyle&&g.from==u&&(p+=" "+y.startStyle),y.endStyle&&g.to==l&&(h+=" "+y.endStyle),y.collapsed&&(!d||d.marker.width<y.width)&&(d=g)):g.from>u&&l>g.from&&(l=g.from),y.type=="bookmark"&&g.from==u&&y.replacedWith&&(v=y.replacedWith)}if(d&&(d.from||0)==u){dr(t,(d.to==null?o:d.to)-u,d.from!=null&&d.marker.replacedWith);if(d.to==null)return d.marker.find()}v&&!d&&dr(t,0,v)}if(u>=o)break;var b=Math.min(o,l);for(;;){if(a){var w=u+a.length;if(!d){var E=w>b?a.slice(0,b-u):a;t.addToken(t,E,f+c,p,u+E.length==l?h:"")}if(w>=b){a=a.slice(b-u),u=b;break}u=w,p=""}a=n[i++],f=fr(n[i++])}}}function mr(e){this.lines=e,this.parent=null;for(var t=0,n=e.length,r=0;t<n;++t)e[t].parent=this,r+=e[t].height;this.height=r}function gr(e){this.children=e;var t=0,n=0;for(var r=0,i=e.length;r<i;++r){var s=e[r];t+=s.chunkSize(),n+=s.height,s.parent=this}this.size=t,this.height=n,this.parent=null}function yr(e,t){while(!e.lines)for(var n=0;;++n){var r=e.children[n],i=r.chunkSize();if(t<i){e=r;break}t-=i}return e.lines[t]}function br(e,t){var n=t-e.height;for(var r=e;r;r=r.parent)r.height+=n}function wr(e){if(e.parent==null)return null;var t=e.parent,n=$r(t.lines,e);for(var r=t.parent;r;t=r,r=r.parent)for(var i=0;;++i){if(r.children[i]==t)break;n+=r.children[i].chunkSize()}return n}function Er(e,t){var n=0;e:do{for(var r=0,i=e.children.length;r<i;++r){var s=e.children[r],o=s.height;if(t<o){e=s;continue e}t-=o,n+=s.chunkSize()}return n}while(!e.lines);for(var r=0,i=e.lines.length;r<i;++r){var u=e.lines[r],a=u.height;if(t<a)break;t-=a}return n+r}function Sr(e,t){t=Kn(e.view.doc,t);var n=0,r=t.parent;for(var i=0;i<r.lines.length;++i){var s=r.lines[i];if(s==t)break;n+=s.height}for(var o=r.parent;o;r=o,o=r.parent)for(var i=0;i<o.children.length;++i){var u=o.children[i];if(u==r)break;n+=u.height}return n}function xr(e){var t=e.order;return t==null&&(t=e.order=xi(e.text)),t}function Tr(){return{done:[],undone:[],lastTime:0,lastOp:null,lastOrigin:null,dirtyCounter:0}}function Nr(e,t,n,r,i,s,o,u,a){var f=e.view.history;f.undone.length=0;var l=+(new Date),c=Xr(f.done);if(c&&(f.lastOp==e.curOp.id||f.lastOrigin==i&&(i=="input"||i=="delete")&&f.lastTime>l-600)){var h=Xr(c.events);if(h.start>t+r.length||h.start+h.added<t)c.events.push({start:t,added:n,old:r});else{var p=Math.max(0,h.start-t),d=Math.max(0,t+r.length-(h.start+h.added));for(var v=p;v>0;--v)h.old.unshift(r[v-1]);for(var v=d;v>0;--v)h.old.push(r[r.length-v]);p&&(h.start=t),h.added+=n-(r.length-p-d)}c.fromAfter=u,c.toAfter=a}else{c={events:[{start:t,added:n,old:r}],fromBefore:s,toBefore:o,fromAfter:u,toAfter:a},f.done.push(c);while(f.done.length>e.options.undoDepth)f.done.shift();f.dirtyCounter<0?f.dirtyCounter=NaN:f.dirtyCounter++}f.lastTime=l,f.lastOp=e.curOp.id,f.lastOrigin=i}function Cr(){Or(this)}function kr(e){return e.stop||(e.stop=Cr),e}function Lr(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function Ar(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function Or(e){Lr(e),Ar(e)}function Mr(e){return e.target||e.srcElement}function _r(e){var t=e.which;return t==null&&(e.button&1?t=1:e.button&2?t=3:e.button&4&&(t=2)),v&&e.ctrlKey&&t==1&&(t=3),t}function Dr(e,t){var n=e.override&&e.override.hasOwnProperty(t);return n?e.override[t]:e[t]}function Pr(e,t,n){if(e.addEventListener)e.addEventListener(t,n,!1);else if(e.attachEvent)e.attachEvent("on"+t,n);else{var r=e._handlers||(e._handlers={}),i=r[t]||(r[t]=[]);i.push(n)}}function Hr(e,t,n){if(e.removeEventListener)e.removeEventListener(t,n,!1);else if(e.detachEvent)e.detachEvent("on"+t,n);else{var r=e._handlers&&e._handlers[t];if(!r)return;for(var i=0;i<r.length;++i)if(r[i]==n){r.splice(i,1);break}}}function Br(e,t){var n=e._handlers&&e._handlers[t];if(!n)return;var r=Array.prototype.slice.call(arguments,2);for(var i=0;i<n.length;++i)n[i].apply(null,r)}function jr(e,t,n){function o(e){return function(){e.apply(null,i)}}var r=t._handlers&&t._handlers[n];if(!r)return;var i=Array.prototype.slice.call(arguments,3),s=e.curOp&&e.curOp.delayedCallbacks;for(var u=0;u<r.length;++u)s?s.push(o(r[u])):r[u].apply(null,i)}function Fr(e,t){var n=e._handlers&&e._handlers[t];return n&&n.length>0}function Rr(){this.id=null}function Ur(e,t,n){t==null&&(t=e.search(/[^\s\u00a0]/),t==-1&&(t=e.length));for(var r=0,i=0;r<t;++r)e.charAt(r)=="	"?i+=n-i%n:++i;return i}function Wr(e){while(zr.length<=e)zr.push(Xr(zr)+" ");return zr[e]}function Xr(e){return e[e.length-1]}function Vr(e){p?(e.selectionStart=0,e.selectionEnd=e.value.length):e.select()}function $r(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]==t)return n;return-1}function Jr(e){for(var t=[],n=0;n<e;++n)t.push(undefined);return t}function Kr(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function Gr(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Qr.test(e))}function Yr(e){var t=0;for(var n in e)e.hasOwnProperty(n)&&e[n]&&++t;return!t}function ei(e,t,n,r){var i=document.createElement(e);n&&(i.className=n),r&&(i.style.cssText=r);if(typeof t=="string")ri(i,t);else if(t)for(var s=0;s<t.length;++s)i.appendChild(t[s]);return i}function ti(e){return e.innerHTML="",e}function ni(e,t){return ti(e).appendChild(t)}function ri(e,t){r?(e.innerHTML="",e.appendChild(document.createTextNode(t))):e.textContent=t}function ui(e){if(oi!=null)return oi;var t=ei("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return ni(e,t),t.offsetWidth&&(oi=t.offsetHeight-t.clientHeight),oi||0}function fi(e){if(ai==null){var t=ei("span","​");ni(e,ei("span",[t,document.createTextNode("x")])),e.firstChild.offsetHeight!=0&&(ai=t.offsetWidth<=1&&t.offsetHeight>2&&!n)}return ai?ei("span","​"):ei("span"," ",null,"display: inline-block; width: 1px; margin-right: -1px")}function di(e,t,n,r){if(!e)return r(t,n,"ltr");for(var i=0;i<e.length;++i){var s=e[i];s.from<n&&s.to>t&&r(Math.max(s.from,t),Math.min(s.to,n),s.level==1?"rtl":"ltr")}}function vi(e){return e.level%2?e.to:e.from}function mi(e){return e.level%2?e.from:e.to}function gi(e){var t=xr(e);return t?vi(t[0]):0}function yi(e){var t=xr(e);return t?mi(Xr(t)):e.text.length}function bi(e,t){var n=yr(e.view.doc,t),r=Kn(e.view.doc,n);r!=n&&(t=wr(r));var i=xr(r),s=i?i[0].level%2?yi(r):gi(r):0;return{line:t,ch:s}}function wi(e,t){var n,r;while(n=Jn(r=yr(e.view.doc,t)))t=n.find().to.line;var i=xr(r),s=i?i[0].level%2?gi(r):yi(r):r.text.length;return{line:t,ch:s}}function Ei(e,t,n,r){var i=xr(e);if(!i)return Si(e,t,n,r);var s=r?function(t,n){do t+=n;while(t>0&&Zr.test(e.text.charAt(t)));return t}:function(e,t){return e+t},o=i[0].level;for(var u=0;u<i.length;++u){var a=i[u],f=a.level%2==o;if(a.from<t&&a.to>t||f&&(a.from==t||a.to==t))break}var l=s(t,a.level%2?-n:n);while(l!=null)if(a.level%2==o){if(!(l<a.from||l>a.to))break;a=i[u+=n],l=a&&(n>0==a.level%2?s(a.to,-1):s(a.from,1))}else if(l==vi(a))a=i[--u],l=a&&mi(a);else{if(l!=mi(a))break;a=i[++u],l=a&&vi(a)}return l<0||l>e.text.length?null:l}function Si(e,t,n,r){var i=t+n;if(r)while(i>0&&Zr.test(e.text.charAt(i)))i+=n;return i<0||i>e.text.length?null:i}var e=/gecko\/\d/i.test(navigator.userAgent),t=/MSIE \d/.test(navigator.userAgent),n=/MSIE [1-7]\b/.test(navigator.userAgent),r=/MSIE [1-8]\b/.test(navigator.userAgent),i=/WebKit\//.test(navigator.userAgent),s=i&&/Qt\/\d+\.\d+/.test(navigator.userAgent),o=/Chrome\//.test(navigator.userAgent),u=/Opera\//.test(navigator.userAgent),a=/Apple Computer/.test(navigator.vendor),f=/KHTML\//.test(navigator.userAgent),l=/Mac OS X 1\d\D([7-9]|\d\d)\D/.test(navigator.userAgent),c=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),h=/PhantomJS/.test(navigator.userAgent),p=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),d=p||/Android|webOS|BlackBerry|Opera Mini|IEMobile/i.test(navigator.userAgent),v=p||/Mac/.test(navigator.platform),m=!1,g=!1,ut,xt,Tt,Mt=0,_t,Dt,Pt,Ht,Bt=null;t?Bt=-0.53:e?Bt=15:o?Bt=-0.7:a&&(Bt=-1/3);var qt,zt=null,Jt;y.prototype={getValue:function(e){var t=[],n=this.view.doc;return n.iter(0,n.size,function(e){t.push(e.text)}),t.join(e||"\n")},setValue:ht(null,function(e){var t=this.view.doc,n={line:0,ch:0},r=yr(t,t.size-1).text.length;Gt(this,n,{line:t.size-1,ch:r},li(e),n,n,"setValue")}),getSelection:function(e){return this.getRange(this.view.sel.from,this.view.sel.to,e)},replaceSelection:ht(null,function(e,t,n){var r=this.view.sel;Qt(this,r.from,r.to,li(e),t||"around",n)}),focus:function(){window.focus(),yt(this),Vt(this),vt(this)},setOption:function(e,t){var n=this.options,r=n[e];if(n[e]==t&&e!="mode")return;n[e]=t,En.hasOwnProperty(e)&&ht(this,En[e])(this,t,r)},getOption:function(e){return this.options[e]},getMode:function(){return this.view.mode},addKeyMap:function(e){this.view.keyMaps.push(e)},removeKeyMap:function(e){var t=this.view.keyMaps;for(var n=0;n<t.length;++n)if((typeof e=="string"?t[n].name:t[n])==e)return t.splice(n,1),!0},undo:ht(null,function(){Yt(this,"undo")}),redo:ht(null,function(){Yt(this,"redo")}),indentLine:ht(null,function(e,t,n){typeof t!="string"&&(t==null?t=this.options.smartIndent?"smart":"prev":t=t?"add":"subtract"),un(this.view.doc,e)&&mn(this,e,t,n)}),indentSelection:ht(null,function(e){var t=this.view.sel;if(tn(t.from,t.to))return mn(this,t.from.line,e);var n=t.to.line-(t.to.ch?0:1);for(var r=t.from.line;r<=n;++r)mn(this,r,e)}),historySize:function(){var e=this.view.history;return{undo:e.done.length,redo:e.undone.length}},clearHistory:function(){this.view.history=Tr()},markClean:function(){this.view.history.dirtyCounter=0,this.view.history.lastOp=this.view.history.lastOrigin=null},isClean:function(){return this.view.history.dirtyCounter==0},getHistory:function(){function t(e){for(var t=0,n=[],r;t<e.length;++t){var i=e[t];n.push({events:r=[],fromBefore:i.fromBefore,toBefore:i.toBefore,fromAfter:i.fromAfter,toAfter:i.toAfter});for(var s=0,o=i.events;s<o.length;++s){var u=[],a=o[s];r.push({start:a.start,added:a.added,old:u});for(var f=0;f<a.old.length;++f)u.push(Yn(a.old[f]))}}return n}var e=this.view.history;return{done:t(e.done),undone:t(e.undone)}},setHistory:function(e){var t=this.view.history=Tr();t.done=e.done,t.undone=e.undone},getTokenAt:function(e){var t=this.view.doc;e=on(t,e);var n=K(this,e.line),r=this.view.mode,i=yr(t,e.line),s=new Bn(i.text,this.options.tabSize);while(s.pos<e.ch&&!s.eol()){s.start=s.pos;var o=r.token(s,n)}return{start:s.start,end:s.pos,string:s.current(),className:o||null,type:o||null,state:n}},getStateAfter:function(e){var t=this.view.doc;return e=sn(t,e==null?t.size-1:e),K(this,e+1)},cursorCoords:function(e,t){var n,r=this.view.sel;return e==null?n=r.head:typeof e=="object"?n=on(this.view.doc,e):n=e?r.from:r.to,it(this,n,t||"page")},charCoords:function(e,t){return rt(this,on(this.view.doc,e),t||"page")},coordsChar:function(e){var t=this.display.lineSpace.getBoundingClientRect();return st(this,e.left-t.left,e.top-t.top)},defaultTextHeight:function(){return at(this.display)},markText:ht(null,function(e,t,n){return Fn(this,on(this.view.doc,e),on(this.view.doc,t),n,"range")}),setBookmark:ht(null,function(e,t){return e=on(this.view.doc,e),Fn(this,e,e,t?{replacedWith:t}:{},"bookmark")}),findMarksAt:function(e){var t=this.view.doc;e=on(t,e);var n=[],r=yr(t,e.line).markedSpans;if(r)for(var i=0;i<r.length;++i){var s=r[i];(s.from==null||s.from<=e.ch)&&(s.to==null||s.to>=e.ch)&&n.push(s.marker)}return n},setGutterMarker:ht(null,function(e,t,n){return gn(this,e,function(e){var r=e.gutterMarkers||(e.gutterMarkers={});return r[t]=n,!n&&Yr(r)&&(e.gutterMarkers=null),!0})}),clearGutter:ht(null,function(e){var t=0,n=this,r=n.view.doc;r.iter(0,r.size,function(r){r.gutterMarkers&&r.gutterMarkers[e]&&(r.gutterMarkers[e]=null,pt(n,t,t+1),Yr(r.gutterMarkers)&&(r.gutterMarkers=null)),++t})}),addLineClass:ht(null,function(e,t,n){return gn(this,e,function(e){var r=t=="text"?"textClass":t=="background"?"bgClass":"wrapClass";if(!e[r])e[r]=n;else{if((new RegExp("\\b"+n+"\\b")).test(e[r]))return!1;e[r]+=" "+n}return!0})}),removeLineClass:ht(null,function(e,t,n){return gn(this,e,function(e){var r=t=="text"?"textClass":t=="background"?"bgClass":"wrapClass",i=e[r];if(!i)return!1;if(n==null)e[r]=null;else{var s=i.replace(new RegExp("^"+n+"\\b\\s*|\\s*\\b"+n+"\\b"),"");if(s==i)return!1;e[r]=s||null}return!0})}),addLineWidget:ht(null,function(e,t,n){var r=n||{};return r.node=t,r.noHScroll&&(this.display.alignWidgets=!0),gn(this,e,function(e){return(e.widgets||(e.widgets=[])).push(r),r.line=e,!0}),r}),removeLineWidget:ht(null,function(e){var t=e.line.widgets,n=wr(e.line);if(n==null)return;for(var r=0;r<t.length;++r)t[r]==e&&t.splice(r--,1);pt(this,n,n+1)}),lineInfo:function(e){if(typeof e=="number"){if(!un(this.view.doc,e))return null;var t=e;e=yr(this.view.doc,e);if(!e)return null}else{var t=wr(e);if(t==null)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.showingFrom,to:this.display.showingTo}},addWidget:function(e,t,n,r,i){var s=this.display;e=it(this,on(this.view.doc,e));var o=e.top,u=e.left;t.style.position="absolute",s.sizer.appendChild(t);if(r=="over")o=e.top;else if(r=="near"){var a=Math.max(s.wrapper.clientHeight,this.view.doc.height),f=Math.max(s.sizer.clientWidth,s.lineSpace.clientWidth);e.bottom+t.offsetHeight>a&&e.top>t.offsetHeight&&(o=e.top-t.offsetHeight),u+t.offsetWidth>f&&(u=f-t.offsetWidth)}t.style.top=o+Q(s)+"px",t.style.left=t.style.right="",i=="right"?(u=s.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):(i=="left"?u=0:i=="middle"&&(u=(s.sizer.clientWidth-t.offsetWidth)/2),t.style.left=u+"px"),n&&dn(this,u,o,u+t.offsetWidth,o+t.offsetHeight)},lineCount:function(){return this.view.doc.size},clipPos:function(e){return on(this.view.doc,e)},getCursor:function(e){var t=this.view.sel,n;return e==null||e=="head"?n=t.head:e=="anchor"?n=t.anchor:e=="end"||e===!1?n=t.to:n=t.from,rn(n)},somethingSelected:function(){return!tn(this.view.sel.from,this.view.sel.to)},setCursor:ht(null,function(e,t,n){var r=on(this.view.doc,typeof e=="number"?{line:e,ch:t||0}:e);n?an(this,r):fn(this,r,r)}),setSelection:ht(null,function(e,t){var n=this.view.doc;fn(this,on(n,e),on(n,t||e))}),extendSelection:ht(null,function(e,t){var n=this.view.doc;an(this,on(n,e),t&&on(n,t))}),setExtending:function(e){this.view.sel.extend=e},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){var t=this.view.doc;if(un(t,e))return yr(t,e)},getLineNumber:function(e){return wr(e)},setLine:ht(null,function(e,t){un(this.view.doc,e)&&en(this,t,{line:e,ch:0},{line:e,ch:yr(this.view.doc,e).text.length})}),removeLine:ht(null,function(e){un(this.view.doc,e)&&en(this,"",{line:e,ch:0},on(this.view.doc,{line:e+1,ch:0}))}),replaceRange:ht(null,function(e,t,n){var r=this.view.doc;return t=on(r,t),n=n?on(r,n):t,en(this,e,t,n)}),getRange:function(e,t,n){var r=this.view.doc;e=on(r,e),t=on(r,t);var i=e.line,s=t.line;if(i==s)return yr(r,i).text.slice(e.ch,t.ch);var o=[yr(r,i).text.slice(e.ch)];return r.iter(i+1,s,function(e){o.push(e.text)}),o.push(yr(r,s).text.slice(0,t.ch)),o.join(n||"\n")},triggerOnKeyDown:ht(null,Wt),execCommand:function(e){return Mn[e](this)},moveH:ht(null,function(e,t){var n=this.view.sel,r=e<0?n.from:n.to;if(n.shift||n.extend||tn(n.from,n.to))r=yn(this,e,t,!0);an(this,r,r,e)}),deleteH:ht(null,function(e,t){var n=this.view.sel;tn(n.from,n.to)?en(this,"",n.from,yn(this,e,t,!1),"delete"):en(this,"",n.from,n.to,"delete"),this.curOp.userSelChange=!0}),moveV:ht(null,function(e,t){var n=this.view,r=n.doc,i=this.display,s=n.sel.head,o=it(this,s,"div"),u=o.left,a;n.goalColumn!=null&&(u=n.goalColumn);if(t=="page"){var f=Math.min(i.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);a=o.top+e*f}else t=="line"&&(a=e>0?o.bottom+3:o.top-3);do{var l=st(this,u,a);a+=e*5}while(l.outside&&(e<0?a>0:a<r.height));t=="page"&&(i.scrollbarV.scrollTop+=rt(this,l,"div").top-o.top),an(this,l,l,e),n.goalColumn=u}),toggleOverwrite:function(){(this.view.overwrite=!this.view.overwrite)?this.display.cursor.className+=" CodeMirror-overwrite":this.display.cursor.className=this.display.cursor.className.replace(" CodeMirror-overwrite","")},posFromIndex:function(e){var t=0,n,r=this.view.doc;return r.iter(0,r.size,function(r){var i=r.text.length+1;if(i>e)return n=e,!0;e-=i,++t}),on(r,{line:t,ch:n})},indexFromPos:function(e){if(e.line<0||e.ch<0)return 0;var t=e.ch;return this.view.doc.iter(0,e.line,function(e){t+=e.text.length+1}),t},scrollTo:function(e,t){e!=null&&(this.display.scrollbarH.scrollLeft=this.display.scroller.scrollLeft=e),t!=null&&(this.display.scrollbarV.scrollTop=this.display.scroller.scrollTop=t),B(this,[])},getScrollInfo:function(){var e=this.display.scroller,t=Ir;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:function(e){typeof e=="number"&&(e={line:e,ch:0}),e=e?on(this.view.doc,e):this.view.sel.head,pn(this,e)},setSize:function(e,t){function n(e){return typeof e=="number"||/^\d+$/.test(String(e))?e+"px":e}e!=null&&(this.display.wrapper.style.width=n(e)),t!=null&&(this.display.wrapper.style.height=n(t)),this.refresh()},on:function(e,t){Pr(this,e,t)},off:function(e,t){Hr(this,e,t)},operation:function(e){return ht(this,e)()},refresh:function(){tt(this),this.display.scroller.scrollHeight>this.view.scrollTop&&(this.display.scrollbarV.scrollTop=this.display.scroller.scrollTop=this.view.scrollTop),B(this,!0)},getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};var En=y.optionHandlers={},Sn=y.defaults={},Tn=y.Init={toString:function(){return"CodeMirror.Init"}};xn("value","",function(e,t){e.setValue(t)},!0),xn("mode",null,E,!0),xn("indentUnit",2,E,!0),xn("indentWithTabs",!1),xn("smartIndent",!0),xn("tabSize",4,function(e){E(e),tt(e),B(e,!0)},!0),xn("electricChars",!0),xn("theme","default",function(e){T(e),N(e)},!0),xn("keyMap","default",x),xn("extraKeys",null),xn("onKeyEvent",null),xn("onDragEvent",null),xn("lineWrapping",!1,S,!0),xn("gutters",[],function(e){A(e.options),N(e)},!0),xn("lineNumbers",!1,function(e){A(e.options),N(e)},!0),xn("firstLineNumber",1,N,!0),xn("lineNumberFormatter",function(e){return e},N,!0),xn("showCursorWhenSelecting",!1,U,!0),xn("readOnly",!1,function(e,t){t=="nocursor"?($t(e),e.display.input.blur()):t||gt(e,!0)}),xn("dragDrop",!0),xn("cursorBlinkRate",530),xn("cursorHeight",1),xn("workTime",100),xn("workDelay",100),xn("flattenSpans",!0),xn("pollInterval",100),xn("undoDepth",40),xn("viewportMargin",10,function(e){e.refresh()},!0),xn("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),xn("autofocus",null);var Nn=y.modes={},Cn=y.mimeModes={};y.defineMode=function(e,t){!y.defaults.mode&&e!="null"&&(y.defaults.mode=e);if(arguments.length>2){t.dependencies=[];for(var n=2;n<arguments.length;++n)t.dependencies.push(arguments[n])}Nn[e]=t},y.defineMIME=function(e,t){Cn[e]=t},y.resolveMode=function(e){if(typeof e=="string"&&Cn.hasOwnProperty(e))e=Cn[e];else if(typeof e=="string"&&/^[\w\-]+\/[\w\-]+\+xml$/.test(e))return y.resolveMode("application/xml");return typeof e=="string"?{name:e}:e||{name:"null"}},y.getMode=function(e,t){var t=y.resolveMode(t),n=Nn[t.name];if(!n)return y.getMode(e,"text/plain");var r=n(e,t);if(kn.hasOwnProperty(t.name)){var i=kn[t.name];for(var s in i){if(!i.hasOwnProperty(s))continue;r.hasOwnProperty(s)&&(r["_"+s]=r[s]),r[s]=i[s]}}return r.name=t.name,r},y.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),y.defineMIME("text/plain","null");var kn=y.modeExtensions={};y.extendMode=function(e,t){var n=kn.hasOwnProperty(e)?kn[e]:kn[e]={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r])},y.defineExtension=function(e,t){y.prototype[e]=t},y.defineOption=xn;var Ln=[];y.defineInitHook=function(e){Ln.push(e)},y.copyState=An,y.startState=On,y.innerMode=function(e,t){while(e.innerMode){var n=e.innerMode(t);t=n.state,e=n.mode}return n||{mode:e,state:t}};var Mn=y.commands={selectAll:function(e){e.setSelection({line:0,ch:0},{line:e.lineCount()-1})},killLine:function(e){var t=e.getCursor(!0),n=e.getCursor(!1),r=!tn(t,n);!r&&e.getLine(t.line).length==t.ch?e.replaceRange("",t,{line:t.line+1,ch:0},"delete"):e.replaceRange("",t,r?n:{line:t.line},"delete")},deleteLine:function(e){var t=e.getCursor().line;e.replaceRange("",{line:t,ch:0},{line:t},"delete")},undo:function(e){e.undo()},redo:function(e){e.redo()},goDocStart:function(e){e.extendSelection({line:0,ch:0})},goDocEnd:function(e){e.extendSelection({line:e.lineCount()-1})},goLineStart:function(e){e.extendSelection(bi(e,e.getCursor().line))},goLineStartSmart:function(e){var t=e.getCursor(),n=bi(e,t.line),r=e.getLineHandle(n.line),i=xr(r);if(!i||i[0].level==0){var s=Math.max(0,r.text.search(/\S/)),o=t.line==n.line&&t.ch<=s&&t.ch;e.extendSelection({line:n.line,ch:o?0:s})}else e.extendSelection(n)},goLineEnd:function(e){e.extendSelection(wi(e,e.getCursor().line))},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	","end","input")},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.replaceSelection("	","end","input")},transposeChars:function(e){var t=e.getCursor(),n=e.getLine(t.line);t.ch>0&&t.ch<n.length-1&&e.replaceRange(n.charAt(t.ch)+n.charAt(t.ch-1),{line:t.line,ch:t.ch-1},{line:t.line,ch:t.ch+1})},newlineAndIndent:function(e){ht(e,function(){e.replaceSelection("\n","end","input"),e.indentLine(e.getCursor().line,null,!0)})()},toggleOverwrite:function(e){e.toggleOverwrite()}},_n=y.keyMap={};_n.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite"},_n.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Alt-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goWordLeft","Ctrl-Right":"goWordRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delWordBefore","Ctrl-Delete":"delWordAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore",fallthrough:"basic"},_n.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goWordLeft","Alt-Right":"goWordRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delWordBefore","Ctrl-Alt-Backspace":"delWordAfter","Alt-Delete":"delWordAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore",fallthrough:["basic","emacsy"]},_n["default"]=v?_n.macDefault:_n.pcDefault,_n.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},y.isModifierKey=Hn,y.fromTextArea=function(e,t){function i(){e.value=u.getValue()}t||(t={}),t.value=e.value,!t.tabindex&&e.tabindex&&(t.tabindex=e.tabindex);if(t.autofocus==null){var n=document.body;try{n=document.activeElement}catch(r){}t.autofocus=n==e||e.getAttribute("autofocus")!=null&&n==document.body}if(e.form){Pr(e.form,"submit",i);var s=e.form,o=s.submit;try{s.submit=function a(){i(),s.submit=o,s.submit(),s.submit=a}}catch(r){}}e.style.display="none";var u=y(function(t){e.parentNode.insertBefore(t,e.nextSibling)},t);return u.save=i,u.getTextArea=function(){return e},u.toTextArea=function(){i(),e.parentNode.removeChild(u.getWrapperElement()),e.style.display="",e.form&&(Hr(e.form,"submit",i),typeof e.form.submit=="function"&&(e.form.submit=o))},u},Bn.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)||undefined},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(e){var t=this.string.charAt(this.pos);if(typeof e=="string")var n=t==e;else var n=t&&(e.test?e.test(t):e(t));if(n)return++this.pos,t},eatWhile:function(e){var t=this.pos;while(this.eat(e));return this.pos>t},eatSpace:function(){var e=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);if(t>-1)return this.pos=t,!0},backUp:function(e){this.pos-=e},column:function(){return Ur(this.string,this.start,this.tabSize)},indentation:function(){return Ur(this.string,null,this.tabSize)},match:function(e,t,n){if(typeof e!="string"){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&t!==!1&&(this.pos+=i[0].length),i)}var r=function(e){return n?e.toLowerCase():e};if(r(this.string).indexOf(r(e),this.pos)==this.pos)return t!==!1&&(this.pos+=e.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},y.StringStream=Bn,jn.prototype.clear=function(){if(this.explicitlyCleared)return;lt(this.cm);var e=null,t=null;for(var n=0;n<this.lines.length;++n){var r=this.lines[n],i=In(r.markedSpans,this);i.to!=null&&(t=wr(r)),r.markedSpans=qn(r.markedSpans,i),i.from!=null?e=wr(r):this.collapsed&&!Qn(r)&&br(r,at(this.cm.display))}e!=null&&pt(this.cm,e,t+1),this.lines.length=0,this.explicitlyCleared=!0,this.collapsed&&this.cm.view.cantEdit&&(this.cm.view.cantEdit=!1,ln(this.cm)),ct(this.cm),jr(this.cm,this,"clear")},jn.prototype.find=function(){var e,t;for(var n=0;n<this.lines.length;++n){var r=this.lines[n],i=In(r.markedSpans,this);if(i.from!=null||i.to!=null){var s=wr(r);i.from!=null&&(e={line:s,ch:i.from}),i.to!=null&&(t={line:s,ch:i.to})}}return this.type=="bookmark"?e:e&&{from:e,to:t}},window.lineIsHidden=Qn;var ar={},cr=/[\t\u0000-\u0019\u200b\u2028\u2029\uFEFF]/g;mr.prototype={chunkSize:function(){return this.lines.length},remove:function(e,t,n){for(var r=e,i=e+t;r<i;++r){var s=this.lines[r];this.height-=s.height,sr(s),jr(n,s,"delete")}this.lines.splice(e,t)},collapse:function(e){e.splice.apply(e,[e.length,0].concat(this.lines))},insertHeight:function(e,t,n){this.height+=n,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var r=0,i=t.length;r<i;++r)t[r].parent=this},iterN:function(e,t,n){for(var r=e+t;e<r;++e)if(n(this.lines[e]))return!0}},gr.prototype={chunkSize:function(){return this.size},remove:function(e,t,n){this.size-=t;for(var r=0;r<this.children.length;++r){var i=this.children[r],s=i.chunkSize();if(e<s){var o=Math.min(t,s-e),u=i.height;i.remove(e,o,n),this.height-=u-i.height,s==o&&(this.children.splice(r--,1),i.parent=null);if((t-=o)==0)break;e=0}else e-=s}if(this.size-t<25){var a=[];this.collapse(a),this.children=[new mr(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0,n=this.children.length;t<n;++t)this.children[t].collapse(e)},insert:function(e,t){var n=0;for(var r=0,i=t.length;r<i;++r)n+=t[r].height;this.insertHeight(e,t,n)},insertHeight:function(e,t,n){this.size+=t.length,this.height+=n;for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<=o){s.insertHeight(e,t,n);if(s.lines&&s.lines.length>50){while(s.lines.length>50){var u=s.lines.splice(s.lines.length-25,25),a=new mr(u);s.height-=a.height,this.children.splice(r+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(this.children.length<=10)return;var e=this;do{var t=e.children.splice(e.children.length-5,5),n=new gr(t);if(!e.parent){var r=new gr(e.children);r.parent=e,e.children=[r,n],e=r}else{e.size-=n.size,e.height-=n.height;var i=$r(e.parent.children,e);e.parent.children.splice(i+1,0,n)}n.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()},iter:function(e,t,n){this.iterN(e,t-e,n)},iterN:function(e,t,n){for(var r=0,i=this.children.length;r<i;++r){var s=this.children[r],o=s.chunkSize();if(e<o){var u=Math.min(t,o-e);if(s.iterN(e,u,n))return!0;if((t-=u)==0)break;e=0}else e-=o}}},y.e_stop=Or,y.e_preventDefault=Lr,y.e_stopPropagation=Ar,y.on=Pr,y.off=Hr,y.signal=Br;var Ir=30,qr=y.Pass={toString:function(){return"CodeMirror.Pass"}};Rr.prototype={set:function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)}},y.countColumn=Ur;var zr=[""],Qr=/[\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc]/,Zr=/[\u0300-\u036F\u0483-\u0487\u0488-\u0489\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\uA66F\uA670-\uA672\uA674-\uA67D\uA69F]/,ii=function(){if(r)return!1;var e=ei("div");return"draggable"in e||"dragDrop"in e}(),si=/^$/;e?si=/$'/:a?si=/\-[^ \-?]|\?[^ !'\"\),.\-\/:;\?\]\}]/:o&&(si=/\-[^ \-\.?]|\?[^ \-\.?\]\}:;!'\"\),\/]|[\.!\"#&%\)*+,:;=>\]|\}~][\(\{\[<]|\$'/);var oi,ai,li="\n\nb".split(/\n/).length!=3?function(e){var t=0,n=[],r=e.length;while(t<=r){var i=e.indexOf("\n",t);i==-1&&(i=e.length);var s=e.slice(t,e.charAt(i-1)=="\r"?i-1:i),o=s.indexOf("\r");o!=-1?(n.push(s.slice(0,o)),t+=o+1):(n.push(s),t=i+1)}return n}:function(e){return e.split(/\r\n?|\n/)};y.splitLines=li;var ci=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(n){}return!t||t.parentElement()!=e?!1:t.compareEndPoints("StartToEnd",t)!=0},hi=function(){var e=ei("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),typeof e.oncopy=="function")}(),pi={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",91:"Mod",92:"Mod",93:"Mod",109:"-",107:"=",127:"Delete",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63276:"PageUp",63277:"PageDown",63275:"End",63273:"Home",63234:"Left",63232:"Up",63235:"Right",63233:"Down",63302:"Insert",63272:"Delete"};y.keyNames=pi,function(){for(var e=0;e<10;e++)pi[e+48]=String(e);for(var e=65;e<=90;e++)pi[e]=String.fromCharCode(e);for(var e=1;e<=12;e++)pi[e+111]=pi[e+63235]="F"+e}();var xi=function(){function n(n){return n<=255?e.charAt(n):1424<=n&&n<=1524?"R":1536<=n&&n<=1791?t.charAt(n-1536):1792<=n&&n<=2220?"r":"L"}var e="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLL",t="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmmrrrrrrrrrrrrrrrrrr",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,i=/[stwN]/,s=/[LRr]/,o=/[Lb1n]/,u=/[1n]/;return function(t){if(!r.test(t))return!1;var a=t.length,f=[],l=null;for(var c=0,h;c<a;++c){f.push(h=n(t.charCodeAt(c)));if(l==null)if(h=="L")l="L";else if(h=="R"||h=="r")l="R"}l==null&&(l="L");for(var c=0,p=l;c<a;++c){var h=f[c];h=="m"?f[c]=p:p=h}for(var c=0,d=l;c<a;++c){var h=f[c];h=="1"&&d=="r"?f[c]="n":s.test(h)&&(d=h,h=="r"&&(f[c]="R"))}for(var c=1,p=f[0];c<a-1;++c){var h=f[c];h=="+"&&p=="1"&&f[c+1]=="1"?f[c]="1":h==","&&p==f[c+1]&&(p=="1"||p=="n")&&(f[c]=p),p=h}for(var c=0;c<a;++c){var h=f[c];if(h==",")f[c]="N";else if(h=="%"){for(var v=c+1;v<a&&f[v]=="%";++v);var m=c&&f[c-1]=="!"||v<a-1&&f[v]=="1"?"1":"N";for(var g=c;g<v;++g)f[g]=m;c=v-1}}for(var c=0,d=l;c<a;++c){var h=f[c];d=="L"&&h=="1"?f[c]="L":s.test(h)&&(d=h)}for(var c=0;c<a;++c)if(i.test(f[c])){for(var v=c+1;v<a&&i.test(f[v]);++v);var y=(c?f[c-1]:l)=="L",b=(v<a-1?f[v]:l)=="L",m=y||b?"L":"R";for(var g=c;g<v;++g)f[g]=m;c=v-1}var w=[],E;for(var c=0;c<a;)if(o.test(f[c])){var S=c;for(++c;c<a&&o.test(f[c]);++c);w.push({from:S,to:c,level:0})}else{var x=c,T=w.length;for(++c;c<a&&f[c]!="L";++c);for(var g=x;g<c;)if(u.test(f[g])){x<g&&w.splice(T,0,{from:x,to:g,level:1});var N=g;for(++g;g<c&&u.test(f[g]);++g);w.splice(T,0,{from:N,to:g,level:2}),x=g}else++g;x<c&&w.splice(T,0,{from:x,to:c,level:1})}return w[0].level==1&&(E=t.match(/^\s+/))&&(w[0].from=E[0].length,w.unshift({from:0,to:E[0].length,level:0})),Xr(w).level==1&&(E=t.match(/\s+$/))&&(Xr(w).to-=E[0].length,w.push({from:a-E[0].length,to:a,level:0})),w[0].level!=Xr(w).level&&w.push({from:a,to:a,level:w[0].level}),w}}();return y.version="3.0",y}();