(function(){function n(n,i){var s=n.getCursor(),o=n.getTokenAt(s),u=CodeMirror.innerMode(n.getMode(),o.state),a=u.state;if(u.mode.name!="xml")throw CodeMirror.Pass;var f=n.getOption("autoCloseTags"),l=u.mode.configuration=="html",c=typeof f=="object"&&f.dontCloseTags||l&&e,h=typeof f=="object"&&f.indentTags||l&&t;if(i==">"&&a.tagName){var p=a.tagName;o.end>s.ch&&(p=p.slice(0,p.length-o.end+s.ch));var d=p.toLowerCase();if(o.type=="tag"&&a.type=="closeTag"||/\/\s*$/.test(o.string)||c&&r(c,d)>-1)throw CodeMirror.Pass;var v=h&&r(h,d)>-1;n.replaceSelection(">"+(v?"\n\n":"")+"</"+p+">",v?{line:s.line+1,ch:0}:{line:s.line,ch:s.ch+1}),v&&(n.indentLine(s.line+1),n.indentLine(s.line+2));return}if(i=="/"&&o.type=="tag"&&o.string=="<"){var p=a.context&&a.context.tagName;p&&n.replaceSelection("/"+p+">","end");return}throw CodeMirror.Pass}function r(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;++n)if(e[n]==t)return n;return-1}CodeMirror.defineOption("autoCloseTags",!1,function(e,t,r){if(t&&(r==CodeMirror.Init||!r)){var i={name:"autoCloseTags"};if(typeof t!="object"||t.whenClosing)i["'/'"]=function(e){n(e,"/")};if(typeof t!="object"||t.whenOpening)i["'>'"]=function(e){n(e,">")};e.addKeyMap(i)}else!t&&r!=CodeMirror.Init&&r&&e.removeKeyMap("autoCloseTags")});var e=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],t=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"]})();